var f=function(){},h=function(a,c,b){return a.call.apply(a.bind,arguments)},l=function(a,c,b){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(b,d);return a.apply(c,b)}}return function(){return a.apply(c,arguments)}},m=function(a,c,b){m=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?h:l;return m.apply(null,arguments)},n=function(a,
c){function b(){}b.prototype=c.prototype;a.i=c.prototype;a.prototype=new b;a.h=function(a,b,g){for(var q=Array(arguments.length-2),k=2;k<arguments.length;k++)q[k-2]=arguments[k];return c.prototype[b].apply(a,q)}};Function.prototype.bind=Function.prototype.bind||function(a,c){if(1<arguments.length){var b=Array.prototype.slice.call(arguments,1);b.unshift(this,a);return m.apply(null,b)}return m(this,a)};var p=function(a){if(Error.captureStackTrace)Error.captureStackTrace(this,p);else{var c=Error().stack;c&&(this.stack=c)}a&&(this.message=String(a))};n(p,Error);var r=function(a,c){for(var b=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<b.length;)d+=b.shift()+e.shift();return d+b.join("%s")};var t=function(a,c){c.unshift(a);p.call(this,r.apply(null,c));c.shift()};n(t,p);var u=function(a,c,b){if(!a){var d="Assertion failed";if(c)var d=d+(": "+c),e=Array.prototype.slice.call(arguments,2);throw new t(""+d,e||[]);}return a};var v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),w=function(a,c){for(var b,d,e=1;e<arguments.length;e++){d=arguments[e];for(b in d)a[b]=d[b];for(var g=0;g<v.length;g++)b=v[g],Object.prototype.hasOwnProperty.call(d,b)&&(a[b]=d[b])}};var y="StopIteration"in this?this.StopIteration:{message:"StopIteration",stack:""},z=function(){};z.prototype.next=function(){throw y;};z.prototype.g=function(){return this};var A=function(a,c){this.b={};this.a=[];this.f=this.c=0;var b=arguments.length;if(1<b){if(b%2)throw Error("Uneven number of arguments");for(var d=0;d<b;d+=2)this.set(arguments[d],arguments[d+1])}else a&&this.addAll(a)};A.prototype.clear=function(){this.b={};this.f=this.c=this.a.length=0};A.prototype.remove=function(a){return Object.prototype.hasOwnProperty.call(this.b,a)?(delete this.b[a],this.c--,this.f++,this.a.length>2*this.c&&B(this),!0):!1};
var B=function(a){if(a.c!=a.a.length){for(var c=0,b=0;c<a.a.length;){var d=a.a[c];Object.prototype.hasOwnProperty.call(a.b,d)&&(a.a[b++]=d);c++}a.a.length=b}if(a.c!=a.a.length){for(var e={},b=c=0;c<a.a.length;)d=a.a[c],Object.prototype.hasOwnProperty.call(e,d)||(a.a[b++]=d,e[d]=1),c++;a.a.length=b}};A.prototype.get=function(a,c){return Object.prototype.hasOwnProperty.call(this.b,a)?this.b[a]:c};
A.prototype.set=function(a,c){Object.prototype.hasOwnProperty.call(this.b,a)||(this.c++,this.a.push(a),this.f++);this.b[a]=c};A.prototype.addAll=function(a){var c;if(a instanceof A){B(a);c=a.a.concat();B(a);for(var b=[],d=0;d<a.a.length;d++)b.push(a.b[a.a[d]]);a=b}else{c=[];var d=0,e;for(e in a)c[d++]=e;d=[];e=0;for(b in a)d[e++]=a[b];a=d}for(b=0;b<c.length;b++)this.set(c[b],a[b])};
A.prototype.g=function(a){B(this);var c=0,b=this.f,d=this,e=new z;e.next=function(){if(b!=d.f)throw Error("The map has changed since the iterator was created");if(c>=d.a.length)throw y;var g=d.a[c++];return a?g:d.b[g]};return e};var C=function(a,c){var b=new FileReader;b.onloadend=function(){b.result&&c(b.result)};var d=new XMLHttpRequest;d.open("GET",a+"=s1200-rw");d.responseType="blob";d.onload=function(){4==d.readyState&&b.readAsDataURL(u(d.response))};d.send()},F=function(){D(function(a){a.length?chrome.storage.local.clear(function(){chrome.storage.sync.get("lastId",function(c){var b=c.lastId&&c.lastId.id||0;E(b);var d=a[b]||a[0];d.image?C(d.image,function(c){chrome.storage.local.set({assetCount:a.length,currentAsset:{id:b,
image:c,info:d},nextAsset:{}})}):console.log("Initialization failed, no image found.")})}):console.log("Asset data is empty.")})},D=function(a){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==c.readyState){var b=JSON.parse(c.responseText);a(b)}};c.open("GET","https://www.gstatic.com/culturalinstitute/tabext/imax.json");try{c.send()}catch(b){console.log("Something went wrong. Couldn't load asset data.")}},E=function(a){var c={};c.lastId={id:a,timestamp:Date.now()};chrome.storage.sync.set(c,
f)},G={showAppsButton:!1,showDefaultTabLink:!1,showTopSitesButton:!0,turnoverModeDaily:!0},H=function(a){chrome.storage.sync.get("settings",function(c){var b={settings:G};w(b,c);a(b.settings)})};(function(){var a=["page","browser_action"],c=["chrome-extension://"+chrome.i18n.getMessage("@@extension_id")+"/index_compiled.html"],b=function(b,d,e){chrome.contextMenus.create({checked:b[d],contexts:a,documentUrlPatterns:c,id:d,parentId:e,title:chrome.i18n.getMessage(d),type:e?"radio":"checkbox"})},d=function(a,b){chrome.contextMenus.update(b,{checked:a[b]})},e=new A;chrome.runtime.onMessage.addListener(m(function(a,b,c){if(void 0!==a.newTab){var x=e.get(b.tab.id);"number"==typeof x||e.set(b.tab.id,
a.newTab);c(x)}else void 0!==a.updateTab?e.set(b.tab.id,a.updateTab):void 0!==a.settingsUpdate&&"background"!=a.initiator&&(a=a.settingsUpdate,d(a,"turnoverModeDaily"),d(a,"turnoverModeAlways"),d(a,"showAppsButton"),d(a,"showDefaultTabLink"),d(a,"showTopSitesButton"))},this));chrome.tabs.onRemoved.addListener(function(a){e.remove(a.id)});chrome.contextMenus.onClicked.addListener(function(a){a.menuItemId&&H(function(b){if("turnoverGroup"==a.parentMenuItemId){var c="turnoverModeDaily"==a.menuItemId&&
a.checked;b.turnoverModeDaily=c;b.turnoverModeAlways=!c}else b[a.menuItemId]=a.checked;c={};c.settings=b;chrome.storage.sync.set(c,f);c={};c.settingsUpdate=b;c.initiator="background";chrome.runtime.sendMessage(c)})});chrome.browserAction.onClicked.addListener(function(){chrome.tabs.create({url:"https://www.google.com/culturalinstitute?utm_source=chrome_extension&utm_medium=default_link&utm_campaign=chrome_extension_1"})});chrome.runtime.onInstalled.addListener(m(function(){F();H(function(d){chrome.contextMenus.create({contexts:a,
documentUrlPatterns:c,type:"separator"});chrome.contextMenus.create({contexts:a,documentUrlPatterns:c,id:"turnoverGroup",title:chrome.i18n.getMessage("turnoverGroup")});b(d,"turnoverModeDaily","turnoverGroup");b(d,"turnoverModeAlways","turnoverGroup");chrome.contextMenus.create({contexts:a,documentUrlPatterns:c,type:"separator"});b(d,"showAppsButton");b(d,"showDefaultTabLink");b(d,"showTopSitesButton")})},this))})();
