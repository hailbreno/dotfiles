!function t(e,r,n){function i(s,a){if(!r[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};e[s][0].call(l.exports,function(t){var r=e[s][1][t];return i(r?r:t)},l,l.exports,t,e,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,e,r){"use strict";function n(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function i(t){return 3*t.length/4-n(t)}function o(t){var e,r,i,o,s,a,u=t.length;s=n(t),a=new f(3*u/4-s),i=s>0?u-4:u;var c=0;for(e=0,r=0;i>e;e+=4,r+=3)o=l[t.charCodeAt(e)]<<18|l[t.charCodeAt(e+1)]<<12|l[t.charCodeAt(e+2)]<<6|l[t.charCodeAt(e+3)],a[c++]=o>>16&255,a[c++]=o>>8&255,a[c++]=255&o;return 2===s?(o=l[t.charCodeAt(e)]<<2|l[t.charCodeAt(e+1)]>>4,a[c++]=255&o):1===s&&(o=l[t.charCodeAt(e)]<<10|l[t.charCodeAt(e+1)]<<4|l[t.charCodeAt(e+2)]>>2,a[c++]=o>>8&255,a[c++]=255&o),a}function s(t){return c[t>>18&63]+c[t>>12&63]+c[t>>6&63]+c[63&t]}function a(t,e,r){for(var n,i=[],o=e;r>o;o+=3)n=(t[o]<<16)+(t[o+1]<<8)+t[o+2],i.push(s(n));return i.join("")}function u(t){for(var e,r=t.length,n=r%3,i="",o=[],s=16383,u=0,l=r-n;l>u;u+=s)o.push(a(t,u,u+s>l?l:u+s));return 1===n?(e=t[r-1],i+=c[e>>2],i+=c[e<<4&63],i+="=="):2===n&&(e=(t[r-2]<<8)+t[r-1],i+=c[e>>10],i+=c[e>>4&63],i+=c[e<<2&63],i+="="),o.push(i),o.join("")}r.byteLength=i,r.toByteArray=o,r.fromByteArray=u;for(var c=[],l=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=0,d=h.length;d>p;++p)c[p]=h[p],l[h.charCodeAt(p)]=p;l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],2:[function(t,e,r){(function(t,n){!function(t){if("object"==typeof r&&"undefined"!=typeof e)e.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof n?i=n:"undefined"!=typeof self&&(i=self),i.Promise=t()}}(function(){var e,r,i;return function o(t,e,r){function n(s,a){if(!e[s]){if(!t[s]){var u="function"==typeof _dereq_&&_dereq_;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=e[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return n(r?r:e)},l,l.exports,o,t,e,r)}return e[s].exports}for(var i="function"==typeof _dereq_&&_dereq_,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,e,r){"use strict";e.exports=function(t){function e(t){var e=new r(t),n=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),n}var r=t._SomePromiseArray;t.any=function(t){return e(t)},t.prototype.any=function(){return e(this)}}},{}],2:[function(e,r,n){"use strict";function i(){this._isTickUsed=!1,this._lateQueue=new f(16),this._normalQueue=new f(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=l}function o(t,e,r){this._lateQueue.push(t,e,r),this._queueTick()}function s(t,e,r){this._normalQueue.push(t,e,r),this._queueTick()}function a(t){this._normalQueue._pushOne(t),this._queueTick()}var u;try{throw new Error}catch(c){u=c}var l=e("./schedule"),f=e("./queue"),h=e("./util");i.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},i.prototype.disableTrampolineIfNecessary=function(){h.hasDevTools&&(this._trampolineEnabled=!1)},i.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},i.prototype.fatalError=function(e,r){r?(t.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),t.exit(2)):this.throwLater(e)},i.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(r){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},h.hasDevTools?(i.prototype.invokeLater=function(t,e,r){this._trampolineEnabled?o.call(this,t,e,r):this._schedule(function(){setTimeout(function(){t.call(e,r)},100)})},i.prototype.invoke=function(t,e,r){this._trampolineEnabled?s.call(this,t,e,r):this._schedule(function(){t.call(e,r)})},i.prototype.settlePromises=function(t){this._trampolineEnabled?a.call(this,t):this._schedule(function(){t._settlePromises()})}):(i.prototype.invokeLater=o,i.prototype.invoke=s,i.prototype.settlePromises=a),i.prototype.invokeFirst=function(t,e,r){this._normalQueue.unshift(t,e,r),this._queueTick()},i.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var r=t.shift(),n=t.shift();e.call(r,n)}else e._settlePromises()}},i.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},i.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},i.prototype._reset=function(){this._isTickUsed=!1},r.exports=i,r.exports.firstLineError=u},{"./queue":26,"./schedule":29,"./util":36}],3:[function(t,e,r){"use strict";e.exports=function(t,e,r,n){var i=!1,o=function(t,e){this._reject(e)},s=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(o,o,null,this,t)},a=function(t,e){0===(50397184&this._bitField)&&this._resolveCallback(e.target)},u=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(o){i||(i=!0,t.prototype._propagateFrom=n.propagateFromFunction(),t.prototype._boundValue=n.boundValueFunction());var c=r(o),l=new t(e);l._propagateFrom(this,1);var f=this._target();if(l._setBoundTo(c),c instanceof t){var h={promiseRejectionQueued:!1,promise:l,target:f,bindingPromise:c};f._then(e,s,void 0,l,h),c._then(a,u,void 0,l,h),l._setOnCancel(c)}else l._resolveCallback(f);return l},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152===(2097152&this._bitField)},t.bind=function(e,r){return t.resolve(r).bind(e)}}},{}],4:[function(t,e,r){"use strict";function n(){try{Promise===o&&(Promise=i)}catch(t){}return o}var i;"undefined"!=typeof Promise&&(i=Promise);var o=t("./promise")();o.noConflict=n,e.exports=o},{"./promise":22}],5:[function(t,e,r){"use strict";var n=Object.create;if(n){var i=n(null),o=n(null);i[" size"]=o[" size"]=0}e.exports=function(e){function r(t,r){var n;if(null!=t&&(n=t[r]),"function"!=typeof n){var i="Object "+a.classString(t)+" has no method '"+a.toString(r)+"'";throw new e.TypeError(i)}return n}function n(t){var e=this.pop(),n=r(t,e);return n.apply(t,this)}function i(t){return t[this]}function o(t){var e=+this;return 0>e&&(e=Math.max(0,e+t.length)),t[e]}var s,a=t("./util"),u=a.canEvaluate;a.isIdentifier;e.prototype.call=function(t){var e=[].slice.call(arguments,1);return e.push(t),this._then(n,void 0,void 0,e,void 0)},e.prototype.get=function(t){var e,r="number"==typeof t;if(r)e=o;else if(u){var n=s(t);e=null!==n?n:i}else e=i;return this._then(e,void 0,void 0,t,void 0)}}},{"./util":36}],6:[function(t,e,r){"use strict";e.exports=function(e,r,n,i){var o=t("./util"),s=o.tryCatch,a=o.errorObj,u=e._async;e.prototype["break"]=e.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t.isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var r=t._cancellationParent;if(null==r||!r.isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),e=t,t=r}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),this._enoughBranchesHaveCancelled()?(this._invokeOnCancel(),!0):!1)},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this.isCancellable()&&(this._setCancelled(),u.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(t,e){if(o.isArray(t))for(var r=0;r<t.length;++r)this._doInvokeOnCancel(t[r],e);else if(void 0!==t)if("function"==typeof t){if(!e){var n=s(t).call(this._boundValue());n===a&&(this._attachExtraTrace(n.e),u.throwLater(n.e))}}else t._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),u.invoke(this._doInvokeOnCancel,this,t)},e.prototype._invokeInternalOnCancel=function(){this.isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(t,e,r){"use strict";e.exports=function(e){function r(t,r,a){return function(u){var c=a._boundValue();t:for(var l=0;l<t.length;++l){var f=t[l];if(f===Error||null!=f&&f.prototype instanceof Error){if(u instanceof f)return o(r).call(c,u)}else if("function"==typeof f){var h=o(f).call(c,u);if(h===s)return h;if(h)return o(r).call(c,u)}else if(n.isObject(u)){for(var p=i(f),d=0;d<p.length;++d){var v=p[d];if(f[v]!=u[v])continue t}return o(r).call(c,u)}}return e}}var n=t("./util"),i=t("./es5").keys,o=n.tryCatch,s=n.errorObj;return r}},{"./es5":13,"./util":36}],8:[function(t,e,r){"use strict";e.exports=function(t){function e(){this._trace=new e.CapturedTrace(n())}function r(){return i?new e:void 0}function n(){var t=o.length-1;return t>=0?o[t]:void 0}var i=!1,o=[];return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},e.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},e.prototype._popContext=function(){if(void 0!==this._trace){var t=o.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},e.CapturedTrace=null,e.create=r,e.deactivateLongStackTraces=function(){},e.activateLongStackTraces=function(){var r=t.prototype._pushContext,o=t.prototype._popContext,s=t._peekContext,a=t.prototype._peekContext,u=t.prototype._promiseCreated;e.deactivateLongStackTraces=function(){t.prototype._pushContext=r,t.prototype._popContext=o,t._peekContext=s,t.prototype._peekContext=a,t.prototype._promiseCreated=u,i=!1},i=!0,t.prototype._pushContext=e.prototype._pushContext,t.prototype._popContext=e.prototype._popContext,t._peekContext=t.prototype._peekContext=n,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},e}},{}],9:[function(e,r,n){"use strict";r.exports=function(r,n){function i(t,e){return{promise:e}}function o(){return!1}function s(t,e,r){var n=this;try{t(e,r,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+L.toString(t));n._attachCancellationCallback(t)})}catch(i){return i}}function a(t){if(!this.isCancellable())return this;var e=this._onCancel();void 0!==e?L.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function u(){return this._onCancelField}function c(t){this._onCancelField=t}function l(){this._cancellationParent=void 0,this._onCancelField=void 0}function f(t,e){if(0!==(1&e)){this._cancellationParent=t;var r=t._branchesRemainingToCancel;void 0===r&&(r=0),t._branchesRemainingToCancel=r+1}0!==(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function h(t,e){0!==(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function p(){var t=this._boundTo;return void 0!==t&&t instanceof r?t.isFulfilled()?t.value():void 0:t}function d(){this._trace=new x(this._peekContext())}function v(t,e){if(H(t)){var r=this._trace;if(void 0!==r&&e&&(r=r._parent),void 0!==r)r.attachExtraTrace(t);else if(!t.__stackCleaned__){var n=C(t);L.notEnumerableProp(t,"stack",n.message+"\n"+n.stack.join("\n")),L.notEnumerableProp(t,"__stackCleaned__",!0)}}}function y(t,e,r,n,i){if(void 0===t&&null!==e&&Q){if(void 0!==i&&i._returnedNonUndefined())return;var o=n._bitField;if(0===(65535&o))return;r&&(r+=" ");var s="a promise was created in a "+r+"handler but was not returned from it";n._warn(s,!0,e)}}function _(t,e){var r=t+" is deprecated and will be removed in a future version.";return e&&(r+=" Use "+e+" instead."),g(r)}function g(t,e,n){if(it.warnings){var i,o=new N(t);if(e)n._attachExtraTrace(o);else if(it.longStackTraces&&(i=r._peekContext()))i.attachExtraTrace(o);else{var s=C(o);o.stack=s.message+"\n"+s.stack.join("\n")}J("warning",o)||T(o,"",!0)}}function m(t,e){for(var r=0;r<e.length-1;++r)e[r].push("From previous event:"),e[r]=e[r].join("\n");return r<e.length&&(e[r]=e[r].join("\n")),t+"\n"+e.join("\n")}function b(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}function w(t){for(var e=t[0],r=1;r<t.length;++r){for(var n=t[r],i=e.length-1,o=e[i],s=-1,a=n.length-1;a>=0;--a)if(n[a]===o){s=a;break}for(var a=s;a>=0;--a){var u=n[a];if(e[i]!==u)break;e.pop(),i--}e=n}}function E(t){for(var e=[],r=0;r<t.length;++r){var n=t[r],i="    (No stack trace)"===n||V.test(n),o=i&&et(n);i&&!o&&(q&&" "!==n.charAt(0)&&(n="    "+n),e.push(n))}return e}function k(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),r=0;r<e.length;++r){var n=e[r];if("    (No stack trace)"===n||V.test(n))break}return r>0&&(e=e.slice(r)),e}function C(t){var e=t.stack,r=t.toString();return e="string"==typeof e&&e.length>0?k(t):["    (No stack trace)"],{message:r,stack:E(e)}}function T(t,e,r){if("undefined"!=typeof console){var n;if(L.isObject(t)){var i=t.stack;n=e+W(i,t)}else n=e+String(t);"function"==typeof U?U(n,r):("function"==typeof console.log||"object"==typeof console.log)&&console.log(n)}}function P(t,e,r,n){var i=!1;try{"function"==typeof e&&(i=!0,"rejectionHandled"===t?e(n):e(r,n))}catch(o){D.throwLater(o)}"unhandledRejection"===t?J(t,r,n)||i||T(r,"Unhandled rejection "):J(t,n)}function A(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():L.toString(t);var r=/\[object [a-zA-Z0-9$_]+\]/;if(r.test(e))try{var n=JSON.stringify(t);e=n}catch(i){}0===e.length&&(e="(empty array)")}return"(<"+S(e)+">, no stack trace)"}function S(t){var e=41;return t.length<e?t:t.substr(0,e-3)+"..."}function F(){return"function"==typeof nt}function O(t){var e=t.match(rt);return e?{fileName:e[1],line:parseInt(e[2],10)}:void 0}function j(t,e){if(F()){for(var r,n,i=t.stack.split("\n"),o=e.stack.split("\n"),s=-1,a=-1,u=0;u<i.length;++u){var c=O(i[u]);if(c){r=c.fileName,s=c.line;break}}for(var u=0;u<o.length;++u){var c=O(o[u]);if(c){n=c.fileName,a=c.line;break}}0>s||0>a||!r||!n||r!==n||s>=a||(et=function(t){if(M.test(t))return!0;var e=O(t);return e&&e.fileName===r&&s<=e.line&&e.line<=a?!0:!1})}}function x(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);nt(this,x),e>32&&this.uncycle()}var R,I,U,B=r._getDomain,D=r._async,N=e("./errors").Warning,L=e("./util"),H=L.canAttachTrace,M=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,V=null,W=null,q=!1,z=!(0==L.env("BLUEBIRD_DEBUG")),G=!(0==L.env("BLUEBIRD_WARNINGS")||!z&&!L.env("BLUEBIRD_WARNINGS")),Y=!(0==L.env("BLUEBIRD_LONG_STACK_TRACES")||!z&&!L.env("BLUEBIRD_LONG_STACK_TRACES")),Q=0!=L.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(G||!!L.env("BLUEBIRD_W_FORGOTTEN_RETURN"));r.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},r.prototype._ensurePossibleRejectionHandled=function(){0===(524288&this._bitField)&&(this._setRejectionIsUnhandled(),D.invokeLater(this._notifyUnhandledRejection,this,void 0))},r.prototype._notifyUnhandledRejectionIsHandled=function(){P("rejectionHandled",R,void 0,this)},r.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},r.prototype._returnedNonUndefined=function(){return 0!==(268435456&this._bitField)},r.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),P("unhandledRejection",I,t,this)}},r.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},r.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},r.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},r.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},r.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},r.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},r.prototype._warn=function(t,e,r){return g(t,e,r||this)},r.onPossiblyUnhandledRejection=function(t){var e=B();I="function"==typeof t?null===e?t:e.bind(t):void 0},r.onUnhandledRejectionHandled=function(t){var e=B();R="function"==typeof t?null===e?t:e.bind(t):void 0};var X=function(){};r.longStackTraces=function(){if(D.haveItemsQueued()&&!it.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!it.longStackTraces&&F()){var t=r.prototype._captureStackTrace,e=r.prototype._attachExtraTrace;it.longStackTraces=!0,X=function(){if(D.haveItemsQueued()&&!it.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");r.prototype._captureStackTrace=t,r.prototype._attachExtraTrace=e,n.deactivateLongStackTraces(),D.enableTrampoline(),it.longStackTraces=!1},r.prototype._captureStackTrace=d,r.prototype._attachExtraTrace=v,n.activateLongStackTraces(),D.disableTrampolineIfNecessary()}},r.hasLongStackTraces=function(){return it.longStackTraces&&F()};var $=function(){try{var t=document.createEvent("CustomEvent");return t.initCustomEvent("testingtheevent",!1,!0,{}),L.global.dispatchEvent(t),function(t,e){var r=document.createEvent("CustomEvent");return r.initCustomEvent(t.toLowerCase(),!1,!0,e),!L.global.dispatchEvent(r)}}catch(e){}return function(){return!1}}(),K=function(){return L.isNode?function(){return t.emit.apply(t,arguments)}:L.global?function(t){var e="on"+t.toLowerCase(),r=L.global[e];return r?(r.apply(L.global,[].slice.call(arguments,1)),!0):!1}:function(){return!1}}(),Z={promiseCreated:i,promiseFulfilled:i,promiseRejected:i,promiseResolved:i,promiseCancelled:i,promiseChained:function(t,e,r){return{promise:e,child:r}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,r){return{reason:e,promise:r}},rejectionHandled:i},J=function(t){var e=!1;try{e=K.apply(null,arguments)}catch(r){D.throwLater(r),e=!0}var n=!1;try{n=$(t,Z[t].apply(null,arguments))}catch(r){D.throwLater(r),n=!0}return n||e};r.config=function(t){if(t=Object(t),"longStackTraces"in t&&(t.longStackTraces?r.longStackTraces():!t.longStackTraces&&r.hasLongStackTraces()&&X()),"warnings"in t){var e=t.warnings;it.warnings=!!e,Q=it.warnings,L.isObject(e)&&"wForgottenReturn"in e&&(Q=!!e.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!it.cancellation){if(D.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");r.prototype._clearCancellationData=l,r.prototype._propagateFrom=f,r.prototype._onCancel=u,r.prototype._setOnCancel=c,r.prototype._attachCancellationCallback=a,r.prototype._execute=s,tt=f,it.cancellation=!0}"monitoring"in t&&(t.monitoring&&!it.monitoring?(it.monitoring=!0,r.prototype._fireEvent=J):!t.monitoring&&it.monitoring&&(it.monitoring=!1,r.prototype._fireEvent=o))},r.prototype._fireEvent=o,r.prototype._execute=function(t,e,r){try{t(e,r)}catch(n){return n}},r.prototype._onCancel=function(){},r.prototype._setOnCancel=function(t){},r.prototype._attachCancellationCallback=function(t){},r.prototype._captureStackTrace=function(){},r.prototype._attachExtraTrace=function(){},r.prototype._clearCancellationData=function(){},r.prototype._propagateFrom=function(t,e){};var tt=h,et=function(){return!1},rt=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;L.inherits(x,Error),n.CapturedTrace=x,x.prototype.uncycle=function(){var t=this._length;if(!(2>t)){for(var e=[],r={},n=0,i=this;void 0!==i;++n)e.push(i),i=i._parent;t=this._length=n;for(var n=t-1;n>=0;--n){var o=e[n].stack;void 0===r[o]&&(r[o]=n)}for(var n=0;t>n;++n){var s=e[n].stack,a=r[s];if(void 0!==a&&a!==n){a>0&&(e[a-1]._parent=void 0,e[a-1]._length=1),e[n]._parent=void 0,e[n]._length=1;var u=n>0?e[n-1]:this;t-1>a?(u._parent=e[a+1],u._parent.uncycle(),u._length=u._parent._length+1):(u._parent=void 0,u._length=1);for(var c=u._length+1,l=n-2;l>=0;--l)e[l]._length=c,c++;return}}}},x.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=C(t),r=e.message,n=[e.stack],i=this;void 0!==i;)n.push(E(i.stack.split("\n"))),i=i._parent;w(n),b(n),L.notEnumerableProp(t,"stack",m(r,n)),L.notEnumerableProp(t,"__stackCleaned__",!0)}};var nt=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():A(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,V=t,W=e;var r=Error.captureStackTrace;return et=function(t){return M.test(t)},function(t,e){Error.stackTraceLimit+=6,r(t,e),Error.stackTraceLimit-=6}}var n=new Error;if("string"==typeof n.stack&&n.stack.split("\n")[0].indexOf("stackDetection@")>=0)return V=/@/,W=e,q=!0,function(t){t.stack=(new Error).stack};var i;try{throw new Error}catch(o){i="stack"in o}return"stack"in n||!i||"number"!=typeof Error.stackTraceLimit?(W=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?A(e):e.toString()},null):(V=t,W=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}([]);"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(U=function(t){console.warn(t)},L.isNode&&t.stderr.isTTY?U=function(t,e){var r=e?"[33m":"[31m";console.warn(r+t+"[0m\n")}:L.isNode||"string"!=typeof(new Error).stack||(U=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var it={warnings:G,longStackTraces:!1,cancellation:!1,monitoring:!1};return Y&&r.longStackTraces(),{longStackTraces:function(){return it.longStackTraces},warnings:function(){return it.warnings},cancellation:function(){return it.cancellation},monitoring:function(){return it.monitoring},propagateFromFunction:function(){return tt},boundValueFunction:function(){return p},checkForgottenReturns:y,setBounds:j,warn:g,deprecated:_,CapturedTrace:x,fireDomEvent:$,fireGlobalEvent:K}}},{"./errors":12,"./util":36}],10:[function(t,e,r){"use strict";e.exports=function(t){function e(){return this.value}function r(){throw this.reason}t.prototype["return"]=t.prototype.thenReturn=function(r){return r instanceof t&&r.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:r},void 0)},t.prototype["throw"]=t.prototype.thenThrow=function(t){return this._then(r,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,r,void 0,{reason:t},void 0);var e=arguments[1],n=function(){throw e};return this.caught(t,n)},t.prototype.catchReturn=function(r){if(arguments.length<=1)return r instanceof t&&r.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:r},void 0);var n=arguments[1];n instanceof t&&n.suppressUnhandledRejections();var i=function(){return n};return this.caught(r,i)}}},{}],11:[function(t,e,r){"use strict";e.exports=function(t,e){function r(){return o(this)}function n(t,r){return i(t,r,e,e)}var i=t.reduce,o=t.all;t.prototype.each=function(t){return this.mapSeries(t)._then(r,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return i(this,t,e,e)},t.each=function(t,e){return n(t,e)._then(r,void 0,void 0,t,void 0)},t.mapSeries=n}},{}],12:[function(t,e,r){"use strict";function n(t,e){function r(n){return this instanceof r?(f(this,"message","string"==typeof n?n:e),f(this,"name",t),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new r(n)}return l(r,Error),r}function i(t){return this instanceof i?(f(this,"name","OperationalError"),f(this,"message",t),this.cause=t,this.isOperational=!0,void(t instanceof Error?(f(this,"message",t.message),f(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new i(t)}var o,s,a=t("./es5"),u=a.freeze,c=t("./util"),l=c.inherits,f=c.notEnumerableProp,h=n("Warning","warning"),p=n("CancellationError","cancellation error"),d=n("TimeoutError","timeout error"),v=n("AggregateError","aggregate error");try{o=TypeError,s=RangeError}catch(y){o=n("TypeError","type error"),s=n("RangeError","range error")}for(var _="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),g=0;g<_.length;++g)"function"==typeof Array.prototype[_[g]]&&(v.prototype[_[g]]=Array.prototype[_[g]]);a.defineProperty(v.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),v.prototype.isOperational=!0;var m=0;v.prototype.toString=function(){var t=Array(4*m+1).join(" "),e="\n"+t+"AggregateError of:\n";m++,t=Array(4*m+1).join(" ");for(var r=0;r<this.length;++r){for(var n=this[r]===this?"[Circular AggregateError]":this[r]+"",i=n.split("\n"),o=0;o<i.length;++o)i[o]=t+i[o];n=i.join("\n"),e+=n+"\n"}return m--,e},l(i,Error);var b=Error.__BluebirdErrorTypes__;b||(b=u({CancellationError:p,TimeoutError:d,OperationalError:i,RejectionError:i,AggregateError:v}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),e.exports={Error:Error,TypeError:o,RangeError:s,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:h}},{"./es5":13,"./util":36}],13:[function(t,e,r){var n=function(){"use strict";return void 0===this}();if(n)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(t,e){var r=Object.getOwnPropertyDescriptor(t,e);return!(r&&!r.writable&&!r.set)}};else{var i={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(t){var e=[];for(var r in t)i.call(t,r)&&e.push(r);return e},u=function(t,e){return{value:t[e]}},c=function(t,e,r){return t[e]=r.value,t},l=function(t){return t},f=function(t){try{return Object(t).constructor.prototype}catch(e){return s}},h=function(t){try{return"[object Array]"===o.call(t)}catch(e){return!1}};e.exports={isArray:h,keys:a,names:a,defineProperty:c,getDescriptor:u,freeze:l,getPrototypeOf:f,isES5:n,propertyIsWritable:function(){return!0}}}},{}],14:[function(t,e,r){"use strict";e.exports=function(t,e){var r=t.map;t.prototype.filter=function(t,n){return r(this,t,n,e)},t.filter=function(t,n,i){return r(t,n,i,e)}}},{}],15:[function(t,e,r){"use strict";e.exports=function(e,r){function n(t,e,r){this.promise=t,this.type=e,this.handler=r,this.called=!1,this.cancelPromise=null}function i(t){this.finallyHandler=t}function o(t,e){return null!=t.cancelPromise?(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0):!1}function s(){return u.call(this,this.promise._target()._settledValue())}function a(t){return o(this,t)?void 0:(f.e=t,f)}function u(t){var n=this.promise,u=this.handler;if(!this.called){this.called=!0;var c=this.isFinallyHandler()?u.call(n._boundValue()):u.call(n._boundValue(),t);if(void 0!==c){n._setReturnedNonUndefined();var h=r(c,n);if(h instanceof e){if(null!=this.cancelPromise){if(h.isCancelled()){var p=new l("late cancellation observer");return n._attachExtraTrace(p),f.e=p,f}h.isPending()&&h._attachCancellationCallback(new i(this))}return h._then(s,a,void 0,this,void 0)}}}return n.isRejected()?(o(this),f.e=t,f):(o(this),t)}var c=t("./util"),l=e.CancellationError,f=c.errorObj;return n.prototype.isFinallyHandler=function(){return 0===this.type},i.prototype._resultCancelled=function(){o(this.finallyHandler)},e.prototype._passThrough=function(t,e,r,i){return"function"!=typeof t?this.then():this._then(r,i,void 0,new n(this,e,t),void 0)},e.prototype.lastly=e.prototype["finally"]=function(t){return this._passThrough(t,0,u,u)},e.prototype.tap=function(t){return this._passThrough(t,1,u)},n}},{"./util":36}],16:[function(t,e,r){"use strict";e.exports=function(e,r,n,i,o,s){function a(t,r,n){for(var o=0;o<r.length;++o){n._pushContext();var s=p(r[o])(t);if(n._popContext(),s===h){n._pushContext();var a=e.reject(h.e);return n._popContext(),a}var u=i(s,n);if(u instanceof e)return u}return null}function u(t,r,i,o){var s=this._promise=new e(n);s._captureStackTrace(),s._setOnCancel(this),this._stack=o,this._generatorFunction=t,this._receiver=r,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(d):d,this._yieldedPromise=null}var c=t("./errors"),l=c.TypeError,f=t("./util"),h=f.errorObj,p=f.tryCatch,d=[];f.inherits(u,o),u.prototype._isResolved=function(){return null===this._promise},u.prototype._cleanup=function(){this._promise=this._generator=null},u.prototype._promiseCancelled=function(){if(!this._isResolved()){var t,r="undefined"!=typeof this._generator["return"];if(r)this._promise._pushContext(),t=p(this._generator["return"]).call(this._generator,void 0),this._promise._popContext();else{var n=new e.CancellationError("generator .return() sentinel");e.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),t=p(this._generator["throw"]).call(this._generator,n),this._promise._popContext(),t===h&&t.e===n&&(t=null)}var i=this._promise;this._cleanup(),t===h?i._rejectCallback(t.e,!1):i.cancel()}},u.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=p(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},u.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=p(this._generator["throw"]).call(this._generator,t);this._promise._popContext(),this._continue(e)},u.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof e){var t=this._yieldedPromise;this._yieldedPromise=null,this._promiseCancelled(),t.cancel()}},u.prototype.promise=function(){return this._promise},u.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},u.prototype._continue=function(t){var r=this._promise;if(t===h)return this._cleanup(),r._rejectCallback(t.e,!1);var n=t.value;if(t.done===!0)return this._cleanup(),r._resolveCallback(n);var o=i(n,this._promise);if(!(o instanceof e)&&(o=a(o,this._yieldHandlers,this._promise),null===o))return void this._promiseRejected(new l("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",n)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));o=o._target();var s=o._bitField;0===(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!==(33554432&s)?this._promiseFulfilled(o._value()):0!==(16777216&s)?this._promiseRejected(o._reason()):this._promiseCancelled()},e.coroutine=function(t,e){
if("function"!=typeof t)throw new l("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=Object(e).yieldHandler,n=u,i=(new Error).stack;return function(){var e=t.apply(this,arguments),o=new n(void 0,void 0,r,i),s=o.promise();return o._generator=e,o._promiseFulfilled(void 0),s}},e.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new l("expecting a function but got "+f.classString(t));d.push(t)},e.spawn=function(t){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof t)return r("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new u(t,this),i=n.promise();return n._run(e.spawn),i}}},{"./errors":12,"./util":36}],17:[function(t,e,r){"use strict";e.exports=function(e,r,n,i){var o=t("./util");o.canEvaluate,o.tryCatch,o.errorObj;e.join=function(){var t,e=arguments.length-1;if(e>0&&"function"==typeof arguments[e]){t=arguments[e];var n}var i=[].slice.call(arguments);t&&i.pop();var n=new r(i).promise();return void 0!==t?n.spread(t):n}}},{"./util":36}],18:[function(t,e,r){"use strict";e.exports=function(e,r,n,i,o,s){function a(t,e,r,n){this.constructor$(t),this._promise._captureStackTrace();var i=c();this._callback=null===i?e:i.bind(e),this._preservedValues=n===o?new Array(this.length()):null,this._limit=r,this._inFlight=0,this._queue=r>=1?[]:p,this._init$(void 0,-2)}function u(t,e,r,i){if("function"!=typeof e)return n("expecting a function but got "+l.classString(e));var o="object"==typeof r&&null!==r?r.concurrency:0;return o="number"==typeof o&&isFinite(o)&&o>=1?o:0,new a(t,e,o,i).promise()}var c=e._getDomain,l=t("./util"),f=l.tryCatch,h=l.errorObj,p=[];l.inherits(a,r),a.prototype._init=function(){},a.prototype._promiseFulfilled=function(t,r){var n=this._values,o=this.length(),a=this._preservedValues,u=this._limit;if(0>r){if(r=-1*r-1,n[r]=t,u>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(u>=1&&this._inFlight>=u)return n[r]=t,this._queue.push(r),!1;null!==a&&(a[r]=t);var c=this._promise,l=this._callback,p=c._boundValue();c._pushContext();var d=f(l).call(p,t,r,o),v=c._popContext();if(s.checkForgottenReturns(d,v,null!==a?"Promise.filter":"Promise.map",c),d===h)return this._reject(d.e),!0;var y=i(d,this._promise);if(y instanceof e){y=y._target();var _=y._bitField;if(0===(50397184&_))return u>=1&&this._inFlight++,n[r]=y,y._proxy(this,-1*(r+1)),!1;if(0===(33554432&_))return 0!==(16777216&_)?(this._reject(y._reason()),!0):(this._cancel(),!0);d=y._value()}n[r]=d}var g=++this._totalResolved;return g>=o?(null!==a?this._filter(n,a):this._resolve(n),!0):!1},a.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,r=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var n=t.pop();this._promiseFulfilled(r[n],n)}},a.prototype._filter=function(t,e){for(var r=e.length,n=new Array(r),i=0,o=0;r>o;++o)t[o]&&(n[i++]=e[o]);n.length=i,this._resolve(n)},a.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(t,e){return u(this,t,e,null)},e.map=function(t,e,r,n){return u(t,e,r,n)}}},{"./util":36}],19:[function(t,e,r){"use strict";e.exports=function(e,r,n,i,o){var s=t("./util"),a=s.tryCatch;e.method=function(t){if("function"!=typeof t)throw new e.TypeError("expecting a function but got "+s.classString(t));return function(){var n=new e(r);n._captureStackTrace(),n._pushContext();var i=a(t).apply(this,arguments),s=n._popContext();return o.checkForgottenReturns(i,s,"Promise.method",n),n._resolveFromSyncValue(i),n}},e.attempt=e["try"]=function(t){if("function"!=typeof t)return i("expecting a function but got "+s.classString(t));var n=new e(r);n._captureStackTrace(),n._pushContext();var u;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var c=arguments[1],l=arguments[2];u=s.isArray(c)?a(t).apply(l,c):a(t).call(l,c)}else u=a(t)();var f=n._popContext();return o.checkForgottenReturns(u,f,"Promise.try",n),n._resolveFromSyncValue(u),n},e.prototype._resolveFromSyncValue=function(t){t===s.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},{"./util":36}],20:[function(t,e,r){"use strict";function n(t){return t instanceof Error&&l.getPrototypeOf(t)===Error.prototype}function i(t){var e;if(n(t)){e=new c(t),e.name=t.name,e.message=t.message,e.stack=t.stack;for(var r=l.keys(t),i=0;i<r.length;++i){var o=r[i];f.test(o)||(e[o]=t[o])}return e}return s.markAsOriginatingFromRejection(t),t}function o(t,e){return function(r,n){if(null!==t){if(r){var o=i(a(r));t._attachExtraTrace(o),t._reject(o)}else if(e){var s=[].slice.call(arguments,1);t._fulfill(s)}else t._fulfill(n);t=null}}}var s=t("./util"),a=s.maybeWrapAsError,u=t("./errors"),c=u.OperationalError,l=t("./es5"),f=/^(?:name|message|stack|cause)$/;e.exports=o},{"./errors":12,"./es5":13,"./util":36}],21:[function(t,e,r){"use strict";e.exports=function(e){function r(t,e){var r=this;if(!o.isArray(t))return n.call(r,t,e);var i=a(e).apply(r._boundValue(),[null].concat(t));i===u&&s.throwLater(i.e)}function n(t,e){var r=this,n=r._boundValue(),i=void 0===t?a(e).call(n,null):a(e).call(n,null,t);i===u&&s.throwLater(i.e)}function i(t,e){var r=this;if(!t){var n=new Error(t+"");n.cause=t,t=n}var i=a(e).call(r._boundValue(),t);i===u&&s.throwLater(i.e)}var o=t("./util"),s=e._async,a=o.tryCatch,u=o.errorObj;e.prototype.asCallback=e.prototype.nodeify=function(t,e){if("function"==typeof t){var o=n;void 0!==e&&Object(e).spread&&(o=r),this._then(o,i,void 0,this,t)}return this}}},{"./util":36}],22:[function(e,r,n){"use strict";r.exports=function(){function r(){}function n(t,e){if("function"!=typeof e)throw new g("expecting a function but got "+p.classString(e));if(t.constructor!==i)throw new g("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}function i(t){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,t!==b&&(n(this,t),this._resolveFromExecutor(t)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function o(t){this.promise._resolveCallback(t)}function s(t){this.promise._rejectCallback(t,!1)}function a(t){var e=new i(b);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}var u,c=function(){return new g("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},l=function(){return new i.PromiseInspection(this._target())},f=function(t){return i.reject(new g(t))},h={},p=e("./util");u=p.isNode?function(){var e=t.domain;return void 0===e&&(e=null),e}:function(){return null},p.notEnumerableProp(i,"_getDomain",u);var d=e("./es5"),v=e("./async"),y=new v;d.defineProperty(i,"_async",{value:y});var _=e("./errors"),g=i.TypeError=_.TypeError;i.RangeError=_.RangeError;var m=i.CancellationError=_.CancellationError;i.TimeoutError=_.TimeoutError,i.OperationalError=_.OperationalError,i.RejectionError=_.OperationalError,i.AggregateError=_.AggregateError;var b=function(){},w={},E={},k=e("./thenables")(i,b),C=e("./promise_array")(i,b,k,f,r),T=e("./context")(i),P=T.create,A=e("./debuggability")(i,T),S=(A.CapturedTrace,e("./finally")(i,k)),F=e("./catch_filter")(E),O=e("./nodeback"),j=p.errorObj,x=p.tryCatch;return i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype["catch"]=function(t){var e=arguments.length;if(e>1){var r,n=new Array(e-1),i=0;for(r=0;e-1>r;++r){var o=arguments[r];if(!p.isObject(o))return f("expecting an object but got "+p.classString(o));n[i++]=o}return n.length=i,t=arguments[r],this.then(void 0,F(n,t,this))}return this.then(void 0,t)},i.prototype.reflect=function(){return this._then(l,l,void 0,this,void 0)},i.prototype.then=function(t,e){if(A.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var r=".then() only accepts functions but was passed: "+p.classString(t);arguments.length>1&&(r+=", "+p.classString(e)),this._warn(r)}return this._then(t,e,void 0,void 0,void 0)},i.prototype.done=function(t,e){var r=this._then(t,e,void 0,void 0,void 0);r._setIsFinal()},i.prototype.spread=function(t){return"function"!=typeof t?f("expecting a function but got "+p.classString(t)):this.all()._then(t,void 0,void 0,w,void 0)},i.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},i.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new C(this).promise()},i.prototype.error=function(t){return this.caught(p.originatesFromRejection,t)},i.is=function(t){return t instanceof i},i.fromNode=i.fromCallback=function(t){var e=new i(b);e._captureStackTrace();var r=arguments.length>1?!!Object(arguments[1]).multiArgs:!1,n=x(t)(O(e,r));return n===j&&e._rejectCallback(n.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},i.all=function(t){return new C(t).promise()},i.cast=function(t){var e=k(t);return e instanceof i||(e=new i(b),e._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(t){var e=new i(b);return e._captureStackTrace(),e._rejectCallback(t,!0),e},i.setScheduler=function(t){if("function"!=typeof t)throw new g("expecting a function but got "+p.classString(t));var e=y._schedule;return y._schedule=t,e},i.prototype._then=function(t,e,r,n,o){var s=void 0!==o,a=s?o:new i(b),c=this._target(),l=c._bitField;s||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===n&&0!==(2097152&this._bitField)&&(n=0!==(50397184&l)?this._boundValue():c===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var f=u();if(0!==(50397184&l)){var h,p,d=c._settlePromiseCtx;0!==(33554432&l)?(p=c._rejectionHandler0,h=t):0!==(16777216&l)?(p=c._fulfillmentHandler0,h=e,c._unsetRejectionIsUnhandled()):(d=c._settlePromiseLateCancellationObserver,p=new m("late cancellation observer"),c._attachExtraTrace(p),h=e),y.invoke(d,c,{handler:null===f?h:"function"==typeof h&&f.bind(h),promise:a,receiver:n,value:p})}else c._addCallbacks(t,e,a,n,f);return a},i.prototype._length=function(){return 65535&this._bitField},i.prototype._isFateSealed=function(){return 0!==(117506048&this._bitField)},i.prototype._isFollowing=function(){return 67108864===(67108864&this._bitField)},i.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},i.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},i.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},i.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},i.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},i.prototype._isFinal=function(){return(4194304&this._bitField)>0},i.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},i.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},i.prototype._setAsyncGuaranteed=function(){this._bitField=134217728|this._bitField},i.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==h)return void 0===e&&this._isBound()?this._boundValue():e},i.prototype._promiseAt=function(t){return this[4*t-4+2]},i.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},i.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},i.prototype._boundValue=function(){},i.prototype._migrateCallback0=function(t){var e=(t._bitField,t._fulfillmentHandler0),r=t._rejectionHandler0,n=t._promise0,i=t._receiverAt(0);void 0===i&&(i=h),this._addCallbacks(e,r,n,i,null)},i.prototype._migrateCallbackAt=function(t,e){var r=t._fulfillmentHandlerAt(e),n=t._rejectionHandlerAt(e),i=t._promiseAt(e),o=t._receiverAt(e);void 0===o&&(o=h),this._addCallbacks(r,n,i,o,null)},i.prototype._addCallbacks=function(t,e,r,n,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=r,this._receiver0=n,"function"==typeof t&&(this._fulfillmentHandler0=null===i?t:i.bind(t)),"function"==typeof e&&(this._rejectionHandler0=null===i?e:i.bind(e));else{var s=4*o-4;this[s+2]=r,this[s+3]=n,"function"==typeof t&&(this[s+0]=null===i?t:i.bind(t)),"function"==typeof e&&(this[s+1]=null===i?e:i.bind(e))}return this._setLength(o+1),o},i.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},i.prototype._resolveCallback=function(t,e){if(0===(117506048&this._bitField)){if(t===this)return this._rejectCallback(c(),!1);var r=k(t,this);if(!(r instanceof i))return this._fulfill(t);e&&this._propagateFrom(r,2);var n=r._target();if(n===this)return void this._reject(c());var o=n._bitField;if(0===(50397184&o)){var s=this._length();s>0&&n._migrateCallback0(this);for(var a=1;s>a;++a)n._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(n)}else if(0!==(33554432&o))this._fulfill(n._value());else if(0!==(16777216&o))this._reject(n._reason());else{var u=new m("late cancellation observer");n._attachExtraTrace(u),this._reject(u)}}},i.prototype._rejectCallback=function(t,e,r){var n=p.ensureErrorObject(t),i=n===t;if(!i&&!r&&A.warnings()){var o="a promise was rejected with a non-error: "+p.classString(t);this._warn(o,!0)}this._attachExtraTrace(n,e?i:!1),this._reject(t)},i.prototype._resolveFromExecutor=function(t){var e=this;this._captureStackTrace(),this._pushContext();var r=!0,n=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,r)});r=!1,this._popContext(),void 0!==n&&e._rejectCallback(n,!0)},i.prototype._settlePromiseFromHandler=function(t,e,r,n){var i=n._bitField;if(0===(65536&i)){n._pushContext();var o;e===w?r&&"number"==typeof r.length?o=x(t).apply(this._boundValue(),r):(o=j,o.e=new g("cannot .spread() a non-array: "+p.classString(r))):o=x(t).call(e,r);var s=n._popContext();i=n._bitField,0===(65536&i)&&(o===E?n._reject(r):o===j?n._rejectCallback(o.e,!1):(A.checkForgottenReturns(o,s,"",n,this),n._resolveCallback(o)))}},i.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(t){this._rejectionHandler0=t},i.prototype._settlePromise=function(t,e,n,o){var s=t instanceof i,a=this._bitField,u=0!==(134217728&a);0!==(65536&a)?(s&&t._invokeInternalOnCancel(),n instanceof S&&n.isFinallyHandler()?(n.cancelPromise=t,x(e).call(n,o)===j&&t._reject(j.e)):e===l?t._fulfill(l.call(n)):n instanceof r?n._promiseCancelled(t):s||t instanceof C?t._cancel():n.cancel()):"function"==typeof e?s?(u&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,n,o,t)):e.call(n,o,t):n instanceof r?n._isResolved()||(0!==(33554432&a)?n._promiseFulfilled(o,t):n._promiseRejected(o,t)):s&&(u&&t._setAsyncGuaranteed(),0!==(33554432&a)?t._fulfill(o):t._reject(o))},i.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,r=t.promise,n=t.receiver,o=t.value;"function"==typeof e?r instanceof i?this._settlePromiseFromHandler(e,n,o,r):e.call(n,o,r):r instanceof i&&r._reject(o)},i.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},i.prototype._settlePromise0=function(t,e,r){var n=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,t,i,e)},i.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},i.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var r=c();return this._attachExtraTrace(r),this._reject(r)}this._setFulfilled(),this._rejectionHandler0=t,(65535&e)>0&&(0!==(134217728&e)?this._settlePromises():y.settlePromises(this))}},i.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16))return this._setRejected(),this._fulfillmentHandler0=t,this._isFinal()?y.fatalError(t,p.isNode):void((65535&e)>0?y.settlePromises(this):this._ensurePossibleRejectionHandled())},i.prototype._fulfillPromises=function(t,e){for(var r=1;t>r;r++){var n=this._fulfillmentHandlerAt(r),i=this._promiseAt(r),o=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(i,n,o,e)}},i.prototype._rejectPromises=function(t,e){for(var r=1;t>r;r++){var n=this._rejectionHandlerAt(r),i=this._promiseAt(r),o=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(i,n,o,e)}},i.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!==(16842752&t)){var r=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,r,t),this._rejectPromises(e,r)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,t),this._fulfillPromises(e,n)}this._setLength(0)}this._clearCancellationData()},i.prototype._settledValue=function(){var t=this._bitField;return 0!==(33554432&t)?this._rejectionHandler0:0!==(16777216&t)?this._fulfillmentHandler0:void 0},i.defer=i.pending=function(){A.deprecated("Promise.defer","new Promise");var t=new i(b);return{promise:t,resolve:o,reject:s}},p.notEnumerableProp(i,"_makeSelfResolutionError",c),e("./method")(i,b,k,f,A),e("./bind")(i,b,k,A),e("./cancel")(i,C,f,A),e("./direct_resolve")(i),e("./synchronous_inspection")(i),e("./join")(i,C,k,b,A),i.Promise=i,e("./map.js")(i,C,f,k,b,A),e("./using.js")(i,f,k,P,b,A),e("./timers.js")(i,b,A),e("./generators.js")(i,f,b,k,r,A),e("./nodeify.js")(i),e("./call_get.js")(i),e("./props.js")(i,C,k,f),e("./race.js")(i,b,k,f),e("./reduce.js")(i,C,f,k,b,A),e("./settle.js")(i,C,A),e("./some.js")(i,C,f),e("./promisify.js")(i,b),e("./any.js")(i),e("./each.js")(i,b),e("./filter.js")(i,b),p.toFastProperties(i),p.toFastProperties(i.prototype),a({a:1}),a({b:2}),a({c:3}),a(1),a(function(){}),a(void 0),a(!1),a(new i(b)),A.setBounds(v.firstLineError,p.lastLineError),i}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(t,e,r){"use strict";e.exports=function(e,r,n,i,o){function s(t){switch(t){case-2:return[];case-3:return{}}}function a(t){var n=this._promise=new e(r);t instanceof e&&n._propagateFrom(t,3),n._setOnCancel(this),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var u=t("./util");u.isArray;return u.inherits(a,o),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function c(t,r){var o=n(this._values,this._promise);if(o instanceof e){o=o._target();var a=o._bitField;if(this._values=o,0===(50397184&a))return this._promise._setAsyncGuaranteed(),o._then(c,this._reject,void 0,this,r);if(0===(33554432&a))return 0!==(16777216&a)?this._reject(o._reason()):this._cancel();o=o._value()}if(o=u.asArray(o),null===o){var l=i("expecting an array or an iterable object but got "+u.classString(o)).reason();return void this._promise._rejectCallback(l,!1)}return 0===o.length?void(-5===r?this._resolveEmptyArray():this._resolve(s(r))):void this._iterate(o)},a.prototype._iterate=function(t){var r=this.getActualLength(t.length);this._length=r,this._values=this.shouldCopyValues()?new Array(r):this._values;for(var i=this._promise,o=!1,s=null,a=0;r>a;++a){var u=n(t[a],i);u instanceof e?(u=u._target(),s=u._bitField):s=null,o?null!==s&&u.suppressUnhandledRejections():null!==s?0===(50397184&s)?(u._proxy(this,a),this._values[a]=u):o=0!==(33554432&s)?this._promiseFulfilled(u._value(),a):0!==(16777216&s)?this._promiseRejected(u._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(u,a)}o||i._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},a.prototype._cancel=function(){!this._isResolved()&&this._promise.isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},a.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var r=++this._totalResolved;return r>=this._length?(this._resolve(this._values),!0):!1},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var r=0;r<t.length;++r)t[r]instanceof e&&t[r].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(t){return t},a}},{"./util":36}],24:[function(t,e,r){"use strict";e.exports=function(e,r){function n(t){return!E.test(t)}function i(t){try{return t.__isPromisified__===!0}catch(e){return!1}}function o(t,e,r){var n=p.getDataPropertyOrDefault(t,e+r,b);return n?i(n):!1}function s(t,e,r){for(var n=0;n<t.length;n+=2){var i=t[n];if(r.test(i))for(var o=i.replace(r,""),s=0;s<t.length;s+=2)if(t[s]===o)throw new g("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}function a(t,e,r,n){for(var a=p.inheritedDataKeys(t),u=[],c=0;c<a.length;++c){var l=a[c],f=t[l],h=n===k?!0:k(l,f,t);"function"!=typeof f||i(f)||o(t,l,e)||!n(l,f,t,h)||u.push(l,f)}return s(u,e,r),u}function u(t,n,i,o,s,a){function u(){var i=n;n===h&&(i=this);var o=new e(r);o._captureStackTrace();var s="string"==typeof l&&this!==c?this[l]:t,u=d(o,a);try{s.apply(i,v(arguments,u))}catch(f){o._rejectCallback(y(f),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var c=function(){return this}(),l=t;return"string"==typeof l&&(t=o),p.notEnumerableProp(u,"__isPromisified__",!0),u}function c(t,e,r,n,i){for(var o=new RegExp(C(e)+"$"),s=a(t,e,o,r),u=0,c=s.length;c>u;u+=2){var l=s[u],f=s[u+1],d=l+e;if(n===T)t[d]=T(l,h,l,f,e,i);else{var v=n(f,function(){return T(l,h,l,f,e,i)});p.notEnumerableProp(v,"__isPromisified__",!0),t[d]=v}}return p.toFastProperties(t),t}function l(t,e,r){return T(t,e,void 0,t,null,r)}var f,h={},p=t("./util"),d=t("./nodeback"),v=p.withAppended,y=p.maybeWrapAsError,_=p.canEvaluate,g=t("./errors").TypeError,m="Async",b={__isPromisified__:!0},w=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],E=new RegExp("^(?:"+w.join("|")+")$"),k=function(t){return p.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t},C=function(t){return t.replace(/([$])/,"\\$")},T=_?f:u;e.promisify=function(t,e){if("function"!=typeof t)throw new g("expecting a function but got "+p.classString(t));if(i(t))return t;e=Object(e);var r=void 0===e.context?h:e.context,o=!!e.multiArgs,s=l(t,r,o);return p.copyDescriptors(t,s,n),s},e.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new g("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");e=Object(e);var r=!!e.multiArgs,n=e.suffix;"string"!=typeof n&&(n=m);var i=e.filter;"function"!=typeof i&&(i=k);var o=e.promisifier;if("function"!=typeof o&&(o=T),!p.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=p.inheritedDataKeys(t),a=0;a<s.length;++a){var u=t[s[a]];"constructor"!==s[a]&&p.isClass(u)&&(c(u.prototype,n,i,o,r),c(u,n,i,o,r))}return c(t,n,i,o,r)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(t,e,r){"use strict";e.exports=function(e,r,n,i){function o(t){var e,r=!1;if(void 0!==a&&t instanceof a)e=f(t),r=!0;else{var n=l.keys(t),i=n.length;e=new Array(2*i);for(var o=0;i>o;++o){var s=n[o];e[o]=t[s],e[o+i]=s}}this.constructor$(e),this._isMap=r,this._init$(void 0,-3)}function s(t){var r,s=n(t);return c(s)?(r=s instanceof e?s._then(e.props,void 0,void 0,void 0,void 0):new o(s).promise(),s instanceof e&&r._propagateFrom(s,2),r):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,u=t("./util"),c=u.isObject,l=t("./es5");"function"==typeof Map&&(a=Map);var f=function(){function t(t,n){this[e]=t,this[e+r]=n,e++}var e=0,r=0;return function(n){r=n.size,e=0;var i=new Array(2*n.size);return n.forEach(t,i),i}}(),h=function(t){for(var e=new a,r=t.length/2|0,n=0;r>n;++n){var i=t[r+n],o=t[n];e.set(i,o)}return e};u.inherits(o,r),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var r=++this._totalResolved;if(r>=this._length){var n;if(this._isMap)n=h(this._values);else{n={};for(var i=this.length(),o=0,s=this.length();s>o;++o)n[this._values[o+i]]=this._values[o]}return this._resolve(n),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(t){return t>>1},e.prototype.props=function(){return s(this)},e.props=function(t){return s(t)}}},{"./es5":13,"./util":36}],26:[function(t,e,r){"use strict";function n(t,e,r,n,i){for(var o=0;i>o;++o)r[o+n]=t[o+e],t[o+e]=void 0}function i(t){this._capacity=t,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(t){return this._capacity<t},i.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1);var r=this._front+e&this._capacity-1;this[r]=t,this._length=e+1},i.prototype._unshiftOne=function(t){var e=this._capacity;this._checkCapacity(this.length()+1);var r=this._front,n=(r-1&e-1^e)-e;this[n]=t,this._front=n,this._length=this.length()+1},i.prototype.unshift=function(t,e,r){this._unshiftOne(r),this._unshiftOne(e),this._unshiftOne(t)},i.prototype.push=function(t,e,r){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(t),this._pushOne(e),void this._pushOne(r);var i=this._front+n-3;this._checkCapacity(n);var o=this._capacity-1;this[i+0&o]=t,this[i+1&o]=e,this[i+2&o]=r,this._length=n},i.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t;var r=this._front,i=this._length,o=r+i&e-1;n(this,0,this,e,o)},e.exports=i},{}],27:[function(t,e,r){"use strict";e.exports=function(e,r,n,i){function o(t,o){var u=n(t);if(u instanceof e)return a(u);if(t=s.asArray(t),null===t)return i("expecting an array or an iterable object but got "+s.classString(t));var c=new e(r);void 0!==o&&c._propagateFrom(o,3);for(var l=c._fulfill,f=c._reject,h=0,p=t.length;p>h;++h){var d=t[h];(void 0!==d||h in t)&&e.cast(d)._then(l,f,void 0,c,null)}return c}var s=t("./util"),a=function(t){return t.then(function(e){return o(e,t)})};e.race=function(t){return o(t,void 0)},e.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(t,e,r){"use strict";e.exports=function(e,r,n,i,o,s){function a(t,r,n,i){this.constructor$(t);var s=h();this._fn=null===s?r:s.bind(r),void 0!==n&&(n=e.resolve(n),n._attachCancellationCallback(this)),this._initialValue=n,this._currentCancellable=null,this._eachValues=i===o?[]:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function c(t,e,r,i){if("function"!=typeof e)return n("expecting a function but got "+p.classString(e));var o=new a(t,e,r,i);return o.promise()}function l(t){this.accum=t,this.array._gotAccum(t);var r=i(this.value,this.array._promise);return r instanceof e?(this.array._currentCancellable=r,r._then(f,void 0,void 0,this,void 0)):f.call(this,r)}function f(t){var r=this.array,n=r._promise,i=d(r._fn);n._pushContext();var o;o=void 0!==r._eachValues?i.call(n._boundValue(),t,this.index,this.length):i.call(n._boundValue(),this.accum,t,this.index,this.length),o instanceof e&&(r._currentCancellable=o);var a=n._popContext();return s.checkForgottenReturns(o,a,void 0!==r._eachValues?"Promise.each":"Promise.reduce",n),o}var h=e._getDomain,p=t("./util"),d=p.tryCatch;p.inherits(a,r),a.prototype._gotAccum=function(t){void 0!==this._eachValues&&t!==o&&this._eachValues.push(t)},a.prototype._eachComplete=function(t){return this._eachValues.push(t),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},a.prototype._resultCancelled=function(t){return t===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel()))},a.prototype._iterate=function(t){this._values=t;var r,n,i=t.length;if(void 0!==this._initialValue?(r=this._initialValue,n=0):(r=e.resolve(t[0]),n=1),this._currentCancellable=r,!r.isRejected())for(;i>n;++n){var o={accum:null,value:t[n],index:n,length:i,array:this};r=r._then(l,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(r=r._then(this._eachComplete,void 0,void 0,this,void 0)),r._then(u,u,void 0,r,this)},e.prototype.reduce=function(t,e){return c(this,t,e,null)},e.reduce=function(t,e,r,n){return c(t,e,r,n)}}},{"./util":36}],29:[function(e,r,i){"use strict";var o,s=e("./util"),a=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")};if(s.isNode&&"undefined"==typeof MutationObserver){var u=n.setImmediate,c=t.nextTick;o=s.isRecentNode?function(t){u.call(n,t)}:function(e){c.call(t,e)}}else o="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&window.navigator.standalone?"undefined"!=typeof setImmediate?function(t){setImmediate(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:a:function(){var t=document.createElement("div"),e={attributes:!0},r=!1,n=document.createElement("div"),i=new MutationObserver(function(){t.classList.toggle("foo"),r=!1});i.observe(n,e);var o=function(){r||(r=!0,n.classList.toggle("foo"))};return function(r){var n=new MutationObserver(function(){n.disconnect(),r()});n.observe(t,e),o()}}();r.exports=o},{"./util":36}],30:[function(t,e,r){"use strict";e.exports=function(e,r,n){function i(t){this.constructor$(t)}var o=e.PromiseInspection,s=t("./util");s.inherits(i,r),i.prototype._promiseResolved=function(t,e){this._values[t]=e;var r=++this._totalResolved;return r>=this._length?(this._resolve(this._values),!0):!1},i.prototype._promiseFulfilled=function(t,e){var r=new o;return r._bitField=33554432,r._settledValueField=t,this._promiseResolved(e,r)},i.prototype._promiseRejected=function(t,e){var r=new o;return r._bitField=16777216,r._settledValueField=t,this._promiseResolved(e,r)},e.settle=function(t){return n.deprecated(".settle()",".reflect()"),new i(t).promise()},e.prototype.settle=function(){return e.settle(this)}}},{"./util":36}],31:[function(t,e,r){"use strict";e.exports=function(e,r,n){function i(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(t,e){if((0|e)!==e||0>e)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var r=new i(t),o=r.promise();return r.setHowMany(e),r.init(),o}var s=t("./util"),a=t("./errors").RangeError,u=t("./errors").AggregateError,c=s.isArray,l={};s.inherits(i,r),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var t=c(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,
this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(t){this._howMany=t},i.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()?(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0):!1},i.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(l),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new u,e=this.length();e<this._values.length;++e)this._values[e]!==l&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(t){this._values.push(t)},i.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new a(e)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(t,e){return o(t,e)},e.prototype.some=function(t){return o(this,t)},e._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(t,e,r){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var r=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=e.prototype.isFulfilled=function(){return 0!==(33554432&this._bitField)},o=e.prototype.isRejected=function(){return 0!==(16777216&this._bitField)},s=e.prototype.isPending=function(){return 0===(50397184&this._bitField)},a=e.prototype.isResolved=function(){return 0!==(50331648&this._bitField)};e.prototype.isCancelled=t.prototype._isCancelled=function(){return 65536===(65536&this._bitField)},t.prototype.isCancelled=function(){return this._target()._isCancelled()},t.prototype.isPending=function(){return s.call(this._target())},t.prototype.isRejected=function(){return o.call(this._target())},t.prototype.isFulfilled=function(){return i.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return r.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),n.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},{}],33:[function(t,e,r){"use strict";e.exports=function(e,r){function n(t,n){if(l(t)){if(t instanceof e)return t;var i=o(t);if(i===c){n&&n._pushContext();var u=e.reject(i.e);return n&&n._popContext(),u}if("function"==typeof i){if(s(t)){var u=new e(r);return t._then(u._fulfill,u._reject,void 0,u,null),u}return a(t,i,n)}}return t}function i(t){return t.then}function o(t){try{return i(t)}catch(e){return c.e=e,c}}function s(t){return f.call(t,"_promise0")}function a(t,n,i){function o(t){a&&(a._resolveCallback(t),a=null)}function s(t){a&&(a._rejectCallback(t,f,!0),a=null)}var a=new e(r),l=a;i&&i._pushContext(),a._captureStackTrace(),i&&i._popContext();var f=!0,h=u.tryCatch(n).call(t,o,s);return f=!1,a&&h===c&&(a._rejectCallback(h.e,!0,!0),a=null),l}var u=t("./util"),c=u.errorObj,l=u.isObject,f={}.hasOwnProperty;return n}},{"./util":36}],34:[function(t,e,r){"use strict";e.exports=function(e,r,n){function i(t){this.handle=t}function o(t){return clearTimeout(this.handle),t}function s(t){throw clearTimeout(this.handle),t}var a=t("./util"),u=e.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var c=function(t){return l(+this).thenReturn(t)},l=e.delay=function(t,o){var s,a;return void 0!==o?(s=e.resolve(o)._then(c,null,null,t,void 0),n.cancellation()&&o instanceof e&&s._setOnCancel(o)):(s=new e(r),a=setTimeout(function(){s._fulfill()},+t),n.cancellation()&&s._setOnCancel(new i(a))),s._setAsyncGuaranteed(),s};e.prototype.delay=function(t){return l(t,this)};var f=function(t,e,r){var n;n="string"!=typeof e?e instanceof Error?e:new u("operation timed out"):new u(e),a.markAsOriginatingFromRejection(n),t._attachExtraTrace(n),t._reject(n),null!=r&&r.cancel()};e.prototype.timeout=function(t,e){t=+t;var r,a,u=new i(setTimeout(function(){r.isPending()&&f(r,e,a)},t));return n.cancellation()?(a=this.then(),r=a._then(o,s,void 0,u,void 0),r._setOnCancel(u)):r=this._then(o,s,void 0,u,void 0),r}}},{"./util":36}],35:[function(t,e,r){"use strict";e.exports=function(e,r,n,i,o,s){function a(t){setTimeout(function(){throw t},0)}function u(t){var e=n(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}function c(t,r){function i(){if(s>=c)return l._fulfill();var o=u(t[s++]);if(o instanceof e&&o._isDisposable()){try{o=n(o._getDisposer().tryDispose(r),t.promise)}catch(f){return a(f)}if(o instanceof e)return o._then(i,a,null,null,null)}i()}var s=0,c=t.length,l=new e(o);return i(),l}function l(t,e,r){this._data=t,this._promise=e,this._context=r}function f(t,e,r){this.constructor$(t,e,r)}function h(t){return l.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function p(t){this.length=t,this.promise=null,this[t-1]=null}var d=t("./util"),v=t("./errors").TypeError,y=t("./util").inherits,_=d.errorObj,g=d.tryCatch;l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},l.prototype.tryDispose=function(t){var e=this.resource(),r=this._context;void 0!==r&&r._pushContext();var n=null!==e?this.doDispose(e,t):null;return void 0!==r&&r._popContext(),this._promise._unsetDisposable(),this._data=null,n},l.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},y(f,l),f.prototype.doDispose=function(t,e){var r=this.data();return r.call(t,t,e)},p.prototype._resultCancelled=function(){for(var t=this.length,r=0;t>r;++r){var n=this[r];n instanceof e&&n.cancel()}},e.using=function(){var t=arguments.length;if(2>t)return r("you must pass at least 2 arguments to Promise.using");var i=arguments[t-1];if("function"!=typeof i)return r("expecting a function but got "+d.classString(i));var o,a=!0;2===t&&Array.isArray(arguments[0])?(o=arguments[0],t=o.length,a=!1):(o=arguments,t--);for(var u=new p(t),f=0;t>f;++f){var v=o[f];if(l.isDisposer(v)){var y=v;v=v.promise(),v._setDisposable(y)}else{var m=n(v);m instanceof e&&(v=m._then(h,null,null,{resources:u,index:f},void 0))}u[f]=v}for(var b=new Array(u.length),f=0;f<b.length;++f)b[f]=e.resolve(u[f]).reflect();var w=e.all(b).then(function(t){for(var e=0;e<t.length;++e){var r=t[e];if(r.isRejected())return _.e=r.error(),_;if(!r.isFulfilled())return void w.cancel();t[e]=r.value()}E._pushContext(),i=g(i);var n=a?i.apply(void 0,t):i(t),o=E._popContext();return s.checkForgottenReturns(n,o,"Promise.using",E),n}),E=w.lastly(function(){var t=new e.PromiseInspection(w);return c(u,t)});return u.promise=E,E._setOnCancel(u),E},e.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},e.prototype._isDisposable=function(){return(131072&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},e.prototype.disposer=function(t){if("function"==typeof t)return new f(t,this,i());throw new v}}},{"./errors":12,"./util":36}],36:[function(e,r,i){"use strict";function o(){try{var t=F;return F=null,t.apply(this,arguments)}catch(e){return S.e=e,S}}function s(t){return F=t,o}function a(t){return null==t||t===!0||t===!1||"string"==typeof t||"number"==typeof t}function u(t){return"function"==typeof t||"object"==typeof t&&null!==t}function c(t){return a(t)?new Error(g(t)):t}function l(t,e){var r,n=t.length,i=new Array(n+1);for(r=0;n>r;++r)i[r]=t[r];return i[r]=e,i}function f(t,e,r){if(!P.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var n=Object.getOwnPropertyDescriptor(t,e);return null!=n?null==n.get&&null==n.set?n.value:r:void 0}function h(t,e,r){if(a(t))return t;var n={value:r,configurable:!0,enumerable:!1,writable:!0};return P.defineProperty(t,e,n),t}function p(t){throw t}function d(t){try{if("function"==typeof t){var e=P.names(t.prototype),r=P.isES5&&e.length>1,n=e.length>0&&!(1===e.length&&"constructor"===e[0]),i=R.test(t+"")&&P.names(t).length>0;if(r||n||i)return!0}return!1}catch(o){return!1}}function v(t){function e(){}e.prototype=t;for(var r=8;r--;)new e;return t}function y(t){return I.test(t)}function _(t,e,r){for(var n=new Array(t),i=0;t>i;++i)n[i]=e+i+r;return n}function g(t){try{return t+""}catch(e){return"[no string representation]"}}function m(t){return null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function b(t){try{h(t,"isOperational",!0)}catch(e){}}function w(t){return null==t?!1:t instanceof Error.__BluebirdErrorTypes__.OperationalError||t.isOperational===!0}function E(t){return m(t)&&P.propertyIsWritable(t,"stack")}function k(t){return{}.toString.call(t)}function C(t,e,r){for(var n=P.names(t),i=0;i<n.length;++i){var o=n[i];if(r(o))try{P.defineProperty(e,o,P.getDescriptor(t,o))}catch(s){}}}function T(e,r){return N?t.env[e]:r}var P=e("./es5"),A="undefined"==typeof navigator,S={e:{}},F,O="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof n?n:void 0!==this?this:null,j=function(t,e){function r(){this.constructor=t,this.constructor$=e;for(var r in e.prototype)n.call(e.prototype,r)&&"$"!==r.charAt(r.length-1)&&(this[r+"$"]=e.prototype[r])}var n={}.hasOwnProperty;return r.prototype=e.prototype,t.prototype=new r,t.prototype},x=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var r=0;r<t.length;++r)if(t[r]===e)return!0;return!1};if(P.isES5){var r=Object.getOwnPropertyNames;return function(t){for(var n=[],i=Object.create(null);null!=t&&!e(t);){var o;try{o=r(t)}catch(s){return n}for(var a=0;a<o.length;++a){var u=o[a];if(!i[u]){i[u]=!0;var c=Object.getOwnPropertyDescriptor(t,u);null!=c&&null==c.get&&null==c.set&&n.push(u)}}t=P.getPrototypeOf(t)}return n}}var n={}.hasOwnProperty;return function(r){if(e(r))return[];var i=[];t:for(var o in r)if(n.call(r,o))i.push(o);else{for(var s=0;s<t.length;++s)if(n.call(t[s],o))continue t;i.push(o)}return i}}(),R=/this\s*\.\s*\S+\s*=/,I=/^[a-z$_][a-z$_0-9]*$/i,U=function(){return"stack"in new Error?function(t){return E(t)?t:new Error(g(t))}:function(t){if(E(t))return t;try{throw new Error(g(t))}catch(e){return e}}}(),B=function(t){return P.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var D="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,r=[],n=t[Symbol.iterator]();!(e=n.next()).done;)r.push(e.value);return r};B=function(t){return P.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?D(t):null}}var N="undefined"!=typeof t&&"[object process]"===k(t).toLowerCase(),L={isClass:d,isIdentifier:y,inheritedDataKeys:x,getDataPropertyOrDefault:f,thrower:p,isArray:P.isArray,asArray:B,notEnumerableProp:h,isPrimitive:a,isObject:u,isError:m,canEvaluate:A,errorObj:S,tryCatch:s,inherits:j,withAppended:l,maybeWrapAsError:c,toFastProperties:v,filledRange:_,toString:g,canAttachTrace:E,ensureErrorObject:U,originatesFromRejection:w,markAsOriginatingFromRejection:b,classString:k,copyDescriptors:C,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:N,env:T,global:O};L.isRecentNode=L.isNode&&function(){var e=t.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),L.isNode&&L.toFastProperties(t);try{throw new Error}catch(H){L.lastLineError=H}r.exports=L},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:7}],3:[function(t,e,r){(function(e){"use strict";function n(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(e){return!1}}function i(){return s.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(t,e){if(i()<e)throw new RangeError("Invalid typed array length");return s.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=s.prototype):(null===t&&(t=new s(e)),t.length=e),t}function s(t,e,r){if(!(s.TYPED_ARRAY_SUPPORT||this instanceof s))return new s(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return l(this,t)}return a(this,t,e,r)}function a(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?p(t,e,r,n):"string"==typeof e?f(t,e,r):d(t,e)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(0>t)throw new RangeError('"size" argument must not be negative')}function c(t,e,r,n){return u(e),0>=e?o(t,e):void 0!==r?"string"==typeof n?o(t,e).fill(r,n):o(t,e).fill(r):o(t,e)}function l(t,e){if(u(e),t=o(t,0>e?0:0|v(e)),!s.TYPED_ARRAY_SUPPORT)for(var r=0;e>r;++r)t[r]=0;return t}function f(t,e,r){if(("string"!=typeof r||""===r)&&(r="utf8"),!s.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|_(e,r);t=o(t,n);var i=t.write(e,r);return i!==n&&(t=t.slice(0,i)),t}function h(t,e){var r=e.length<0?0:0|v(e.length);t=o(t,r);for(var n=0;r>n;n+=1)t[n]=255&e[n];return t}function p(t,e,r,n){if(e.byteLength,0>r||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n),s.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=s.prototype):t=h(t,e),t}function d(t,e){if(s.isBuffer(e)){var r=0|v(e.length);return t=o(t,r),0===t.length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||$(e.length)?o(t,0):h(t,e);if("Buffer"===e.type&&J(e.data))return h(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function v(t){if(t>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|t}function y(t){return+t!=t&&(t=0),s.alloc(+t)}function _(t,e){if(s.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return z(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Q(t).length;default:if(n)return z(t).length;e=(""+e).toLowerCase(),n=!0}}function g(t,e,r){var n=!1;if((void 0===e||0>e)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),0>=r)return"";if(r>>>=0,e>>>=0,e>=r)return"";for(t||(t="utf8");;)switch(t){case"hex":return R(this,e,r);case"utf8":case"utf-8":return F(this,e,r);case"ascii":return j(this,e,r);case"latin1":case"binary":return x(this,e,r);case"base64":return S(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function m(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function b(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:-2147483648>r&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),0>r&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(0>r){if(!i)return-1;r=0}if("string"==typeof e&&(e=s.from(e,n)),s.isBuffer(e))return 0===e.length?-1:w(t,e,r,n,i);if("number"==typeof e)return e=255&e,s.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):w(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function w(t,e,r,n,i){function o(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}var s=1,a=t.length,u=e.length;if(void 0!==n&&(n=String(n).toLowerCase(),"ucs2"===n||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,a/=2,u/=2,r/=2}var c;if(i){var l=-1;for(c=r;a>c;c++)if(o(t,c)===o(e,-1===l?0:c-l)){if(-1===l&&(l=c),c-l+1===u)return l*s}else-1!==l&&(c-=c-l),l=-1}else for(r+u>a&&(r=a-u),c=r;c>=0;c--){for(var f=!0,h=0;u>h;h++)if(o(t,c+h)!==o(e,h)){f=!1;break}if(f)return c}return-1}function E(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n),n>i&&(n=i)):n=i;var o=e.length;if(o%2!==0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;n>s;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[r+s]=a}return s}function k(t,e,r,n){return X(z(e,t.length-r),t,r,n)}function C(t,e,r,n){return X(G(e),t,r,n)}function T(t,e,r,n){return C(t,e,r,n)}function P(t,e,r,n){return X(Q(e),t,r,n)}function A(t,e,r,n){return X(Y(e,t.length-r),t,r,n)}function S(t,e,r){return 0===e&&r===t.length?K.fromByteArray(t):K.fromByteArray(t.slice(e,r))}function F(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;r>i;){var o=t[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(r>=i+a){var u,c,l,f;switch(a){case 1:128>o&&(s=o);break;case 2:u=t[i+1],128===(192&u)&&(f=(31&o)<<6|63&u,f>127&&(s=f));break;case 3:u=t[i+1],c=t[i+2],128===(192&u)&&128===(192&c)&&(f=(15&o)<<12|(63&u)<<6|63&c,f>2047&&(55296>f||f>57343)&&(s=f));break;case 4:u=t[i+1],c=t[i+2],l=t[i+3],128===(192&u)&&128===(192&c)&&128===(192&l)&&(f=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&l,f>65535&&1114112>f&&(s=f))}}null===s?(s=65533,a=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=a}return O(n)}function O(t){var e=t.length;if(tt>=e)return String.fromCharCode.apply(String,t);for(var r="",n=0;e>n;)r+=String.fromCharCode.apply(String,t.slice(n,n+=tt));return r}function j(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;r>i;++i)n+=String.fromCharCode(127&t[i]);return n}function x(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;r>i;++i)n+=String.fromCharCode(t[i]);return n}function R(t,e,r){var n=t.length;(!e||0>e)&&(e=0),(!r||0>r||r>n)&&(r=n);for(var i="",o=e;r>o;++o)i+=q(t[o]);return i}function I(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function U(t,e,r){if(t%1!==0||0>t)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function B(t,e,r,n,i,o){if(!s.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||o>e)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function D(t,e,r,n){0>e&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);o>i;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function N(t,e,r,n){0>e&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);o>i;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function L(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(0>r)throw new RangeError("Index out of range")}function H(t,e,r,n,i){return i||L(t,e,r,4,3.4028234663852886e38,-3.4028234663852886e38),Z.write(t,e,r,n,23,4),r+4}function M(t,e,r,n,i){return i||L(t,e,r,8,1.7976931348623157e308,-1.7976931348623157e308),Z.write(t,e,r,n,52,8),r+8}function V(t){if(t=W(t).replace(et,""),t.length<2)return"";for(;t.length%4!==0;)t+="=";return t}function W(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function q(t){return 16>t?"0"+t.toString(16):t.toString(16)}function z(t,e){e=e||1/0;for(var r,n=t.length,i=null,o=[],s=0;n>s;++s){if(r=t.charCodeAt(s),r>55295&&57344>r){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(56320>r){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,128>r){if((e-=1)<0)break;o.push(r)}else if(2048>r){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(65536>r){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(1114112>r))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function G(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function Y(t,e){for(var r,n,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)r=t.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}function Q(t){return K.toByteArray(V(t))}function X(t,e,r,n){for(var i=0;n>i&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function $(t){return t!==t}var K=t("base64-js"),Z=t("ieee754"),J=t("isarray");r.Buffer=s,r.SlowBuffer=y,r.INSPECT_MAX_BYTES=50,s.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:n(),r.kMaxLength=i(),s.poolSize=8192,s._augment=function(t){return t.__proto__=s.prototype,t},s.from=function(t,e,r){return a(null,t,e,r)},s.TYPED_ARRAY_SUPPORT&&(s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0})),s.alloc=function(t,e,r){return c(null,t,e,r)},s.allocUnsafe=function(t){return l(null,t)},s.allocUnsafeSlow=function(t){return l(null,t)},s.isBuffer=function(t){return!(null==t||!t._isBuffer)},s.compare=function(t,e){if(!s.isBuffer(t)||!s.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);o>i;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return n>r?-1:r>n?1:0},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!J(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=s.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var o=t[r];if(!s.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},s.byteLength=_,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;t>e;e+=2)m(this,e,e+1);return this},s.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;t>e;e+=4)m(this,e,e+3),m(this,e+1,e+2);return this},s.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;t>e;e+=8)m(this,e,e+7),m(this,e+1,e+6),m(this,e+2,e+5),m(this,e+3,e+4);return this},s.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?F(this,0,t):g.apply(this,arguments)},s.prototype.equals=function(t){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:0===s.compare(this,t)},s.prototype.inspect=function(){var t="",e=r.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},s.prototype.compare=function(t,e,r,n,i){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),0>e||r>t.length||0>n||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,i>>>=0,this===t)return 0;for(var o=i-n,a=r-e,u=Math.min(o,a),c=this.slice(n,i),l=t.slice(e,r),f=0;u>f;++f)if(c[f]!==l[f]){o=c[f],a=l[f];break}return a>o?-1:o>a?1:0},s.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},s.prototype.indexOf=function(t,e,r){return b(this,t,e,r,!0)},s.prototype.lastIndexOf=function(t,e,r){return b(this,t,e,r,!1)},s.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e=0|e,isFinite(r)?(r=0|r,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(0>r||0>e)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return E(this,t,e,r);case"utf8":case"utf-8":return k(this,t,e,r);case"ascii":return C(this,t,e,r);case"latin1":case"binary":return T(this,t,e,r);case"base64":return P(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var tt=4096;s.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,0>t?(t+=r,0>t&&(t=0)):t>r&&(t=r),0>e?(e+=r,0>e&&(e=0)):e>r&&(e=r),t>e&&(e=t);var n;if(s.TYPED_ARRAY_SUPPORT)n=this.subarray(t,e),n.__proto__=s.prototype;else{var i=e-t;n=new s(i,void 0);for(var o=0;i>o;++o)n[o]=this[o+t]}return n},s.prototype.readUIntLE=function(t,e,r){t=0|t,e=0|e,r||U(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},s.prototype.readUIntBE=function(t,e,r){t=0|t,e=0|e,r||U(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},s.prototype.readUInt8=function(t,e){return e||U(t,1,this.length),this[t]},s.prototype.readUInt16LE=function(t,e){return e||U(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUInt16BE=function(t,e){return e||U(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUInt32LE=function(t,e){return e||U(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},s.prototype.readUInt32BE=function(t,e){return e||U(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readIntLE=function(t,e,r){t=0|t,e=0|e,r||U(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*e)),n},s.prototype.readIntBE=function(t,e,r){t=0|t,e=0|e,r||U(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*e)),o},s.prototype.readInt8=function(t,e){return e||U(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},s.prototype.readInt16LE=function(t,e){e||U(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt16BE=function(t,e){e||U(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt32LE=function(t,e){return e||U(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return e||U(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readFloatLE=function(t,e){return e||U(t,4,this.length),Z.read(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return e||U(t,4,this.length),Z.read(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return e||U(t,8,this.length),Z.read(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return e||U(t,8,this.length),Z.read(this,t,!1,52,8)},s.prototype.writeUIntLE=function(t,e,r,n){if(t=+t,e=0|e,r=0|r,!n){var i=Math.pow(2,8*r)-1;B(this,t,e,r,i,0)}var o=1,s=0;for(this[e]=255&t;++s<r&&(o*=256);)this[e+s]=t/o&255;return e+r},s.prototype.writeUIntBE=function(t,e,r,n){if(t=+t,e=0|e,r=0|r,!n){var i=Math.pow(2,8*r)-1;B(this,t,e,r,i,0)}var o=r-1,s=1;for(this[e+o]=255&t;--o>=0&&(s*=256);)this[e+o]=t/s&255;return e+r},s.prototype.writeUInt8=function(t,e,r){return t=+t,e=0|e,r||B(this,t,e,1,255,0),s.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},s.prototype.writeUInt16LE=function(t,e,r){return t=+t,e=0|e,r||B(this,t,e,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):D(this,t,e,!0),e+2},s.prototype.writeUInt16BE=function(t,e,r){return t=+t,e=0|e,r||B(this,t,e,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):D(this,t,e,!1),e+2},s.prototype.writeUInt32LE=function(t,e,r){return t=+t,e=0|e,r||B(this,t,e,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):N(this,t,e,!0),e+4},s.prototype.writeUInt32BE=function(t,e,r){return t=+t,e=0|e,r||B(this,t,e,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):N(this,t,e,!1),e+4},s.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e=0|e,!n){var i=Math.pow(2,8*r-1);B(this,t,e,r,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<r&&(s*=256);)0>t&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},s.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e=0|e,!n){var i=Math.pow(2,8*r-1);B(this,t,e,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)0>t&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},s.prototype.writeInt8=function(t,e,r){return t=+t,e=0|e,r||B(this,t,e,1,127,-128),s.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),0>t&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,r){return t=+t,e=0|e,r||B(this,t,e,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):D(this,t,e,!0),e+2},s.prototype.writeInt16BE=function(t,e,r){return t=+t,e=0|e,r||B(this,t,e,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):D(this,t,e,!1),e+2},s.prototype.writeInt32LE=function(t,e,r){return t=+t,e=0|e,r||B(this,t,e,4,2147483647,-2147483648),s.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):N(this,t,e,!0),e+4},s.prototype.writeInt32BE=function(t,e,r){return t=+t,e=0|e,r||B(this,t,e,4,2147483647,-2147483648),0>t&&(t=4294967295+t+1),s.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):N(this,t,e,!1),e+4},s.prototype.writeFloatLE=function(t,e,r){return H(this,t,e,!0,r)},s.prototype.writeFloatBE=function(t,e,r){return H(this,t,e,!1,r)},s.prototype.writeDoubleLE=function(t,e,r){return M(this,t,e,!0,r)},s.prototype.writeDoubleBE=function(t,e,r){return M(this,t,e,!1,r)},s.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&r>n&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(0>e)throw new RangeError("targetStart out of bounds");if(0>r||r>=this.length)throw new RangeError("sourceStart out of bounds");if(0>n)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);
var i,o=n-r;if(this===t&&e>r&&n>e)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(1e3>o||!s.TYPED_ARRAY_SUPPORT)for(i=0;o>i;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},s.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);256>i&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t=255&t);if(0>e||this.length<e||this.length<r)throw new RangeError("Out of range index");if(e>=r)return this;e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0);var o;if("number"==typeof t)for(o=e;r>o;++o)this[o]=t;else{var a=s.isBuffer(t)?t:z(new s(t,n).toString()),u=a.length;for(o=0;r-e>o;++o)this[o+e]=a[o%u]}return this};var et=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":1,ieee754:5,isarray:6}],4:[function(t,e,r){(function(t){var e;!function(t){"undefined"==typeof DO_NOT_EXPORT_CRC?"object"==typeof r?t(r):"function"==typeof define&&define.amd?define(function(){var e={};return t(e),e}):t(e={}):t(e={})}(function(e){function r(){for(var t=0,e=new Array(256),r=0;256!=r;++r)t=r,t=1&t?-306674912^t>>>1:t>>>1,t=1&t?-306674912^t>>>1:t>>>1,t=1&t?-306674912^t>>>1:t>>>1,t=1&t?-306674912^t>>>1:t>>>1,t=1&t?-306674912^t>>>1:t>>>1,t=1&t?-306674912^t>>>1:t>>>1,t=1&t?-306674912^t>>>1:t>>>1,t=1&t?-306674912^t>>>1:t>>>1,e[r]=t;return"undefined"!=typeof Int32Array?new Int32Array(e):e}function n(e){if(e.length>32768&&u)return o(new t(e));for(var r=-1,n=e.length-1,i=0;n>i;)r=r>>>8^a[255&(r^e.charCodeAt(i++))],r=r>>>8^a[255&(r^e.charCodeAt(i++))];return i===n&&(r=r>>>8^a[255&(r^e.charCodeAt(i))]),-1^r}function i(t){if(t.length>1e4)return o(t);for(var e=-1,r=t.length-3,n=0;r>n;)e=e>>>8^a[255&(e^t[n++])],e=e>>>8^a[255&(e^t[n++])],e=e>>>8^a[255&(e^t[n++])],e=e>>>8^a[255&(e^t[n++])];for(;r+3>n;)e=e>>>8^a[255&(e^t[n++])];return-1^e}function o(t){for(var e=-1,r=t.length-7,n=0;r>n;)e=e>>>8^a[255&(e^t[n++])],e=e>>>8^a[255&(e^t[n++])],e=e>>>8^a[255&(e^t[n++])],e=e>>>8^a[255&(e^t[n++])],e=e>>>8^a[255&(e^t[n++])],e=e>>>8^a[255&(e^t[n++])],e=e>>>8^a[255&(e^t[n++])],e=e>>>8^a[255&(e^t[n++])];for(;r+7>n;)e=e>>>8^a[255&(e^t[n++])];return-1^e}function s(t){for(var e,r,n=-1,i=0,o=t.length;o>i;)e=t.charCodeAt(i++),128>e?n=n>>>8^a[255&(n^e)]:2048>e?(n=n>>>8^a[255&(n^(192|e>>6&31))],n=n>>>8^a[255&(n^(128|63&e))]):e>=55296&&57344>e?(e=(1023&e)+64,r=1023&t.charCodeAt(i++),n=n>>>8^a[255&(n^(240|e>>8&7))],n=n>>>8^a[255&(n^(128|e>>2&63))],n=n>>>8^a[255&(n^(128|r>>6&15|(3&e)<<4))],n=n>>>8^a[255&(n^(128|63&r))]):(n=n>>>8^a[255&(n^(224|e>>12&15))],n=n>>>8^a[255&(n^(128|e>>6&63))],n=n>>>8^a[255&(n^(128|63&e))]);return-1^n}e.version="0.4.1";var a=r(),u="undefined"!=typeof t;e.table=a,e.bstr=n,e.buf=i,e.str=s})}).call(this,t("buffer").Buffer)},{buffer:3}],5:[function(t,e,r){r.read=function(t,e,r,n,i){var o,s,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,f=r?i-1:0,h=r?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:(p?-1:1)*(1/0);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)},r.write=function(t,e,r,n,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,v=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),e+=s+f>=1?h/u:h*Math.pow(2,1-f),e*u>=2&&(s++,u/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(e*u-1)*Math.pow(2,i),s+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;t[r+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;t[r+p]=255&s,p+=d,s/=256,c-=8);t[r+p-d]|=128*v}},{}],6:[function(t,e,r){var n={}.toString;e.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},{}],7:[function(t,e,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(f===setTimeout)return setTimeout(t,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(t,0);try{return f(t,0)}catch(e){try{return f.call(null,t,0)}catch(e){return f.call(this,t,0)}}}function s(t){if(h===clearTimeout)return clearTimeout(t);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function a(){y&&d&&(y=!1,d.length?v=d.concat(v):_=-1,v.length&&u())}function u(){if(!y){var t=o(a);y=!0;for(var e=v.length;e;){for(d=v,v=[];++_<e;)d&&d[_].run();_=-1,e=v.length}d=null,y=!1,s(t)}}function c(t,e){this.fun=t,this.array=e}function l(){}var f,h,p=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(t){f=n}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(t){h=i}}();var d,v=[],y=!1,_=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];v.push(new c(t,e)),1!==v.length||y||o(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],8:[function(t,e,r){"use strict";function n(){var t=[],e=0;this.getInternalQueue=function(){return t},this.getLength=function(){return t.length-e},this.isEmpty=function(){return 0===t.length},this.enqueue=function(e){t.push(e)},this.tail=function(){var e=t.length;if(0!==e)return t[e-1]},this.dequeue=function(){if(0!==t.length){var r=t[e];return t[e]=null,2*++e>=t.length&&(t=t.slice(e),e=0),r}},this.peek=function(){return t.length>0?t[e]:void 0},this.elementAt=function(e){return e>=t.length?null:t[e]}}e.exports=n},{}],9:[function(t,e,r){"use strict";var n=t("./chromeApp"),i=null;chrome.runtime.onConnectExternal.addListener(function(t){i?i.addPort(t):i=new n(t)}),chrome.runtime.onConnect.addListener(function(t){i?i.addPort(t):console.log("cannot connect app to popup")}),chrome.app.runtime.onLaunched.addListener(function(t){i||(i=new n(null,t)),i.showOrCreateWindow()})},{"./chromeApp":11}],10:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=t("bluebird"),s=(t("./log"),t("./util")),a=t("./mkimage"),u=(t("./uboot"),s.LITTLE_ENDIAN),c=257,l=258,f=259,h=17,p=18,d=4194304,v=13,y=8,_=s.stringToArr("AWUS"),g="AWUC",m=1241513984,b=1107296256,w=1124073472,E=1127219200,k=1125122048,C=24,T=function(){function t(e){n(this,t),this.dataTransferHandler=e,this.diagnosticMode=!1}return i(t,[{key:"waitForFel",value:function(t){var e=this.dataTransferHandler,r=t?e.resetChips():o.resolve();return r.then(function(){return e.initialize()}).then(e.waitForStatePromise.bind(e))}},{key:"ping",value:function(){return this.read(31744,8)["return"](!0)["catch"](function(){return!1})}},{key:"setDataProcessor",value:function(t){this.dataProcessor=t}},{key:"read",value:function(t,e){var r=this;return this._request(f,t,e).then(this._usbRead.bind(this,e)).then(function(t){return r._status()["return"](t)})}},{key:"write",value:function(t,e){return t instanceof Uint8Array&&(t=t.buffer),this._request(c,e,t.byteLength).then(this._usbWrite.bind(this,t)).then(this._status.bind(this))}},{key:"writeUboot",value:function(t){return this.write(t,m)}},{key:"writeZImage",value:function(t){return this.write(t,b)}},{key:"writeDtb",value:function(t){return this.write(t,w)}},{key:"writeRootFs",value:function(t){return this.write(t,E)}},{key:"writeUbootScript",value:function(t){var e=this;return this.write(a.toImage(t),k).then(function(){var t=new ArrayBuffer(4);return new DataView(t).setUint32(0,k,u),e.write(t,C)})}},{key:"exe",value:function(t){return this._request(l,t,0).then(this._status.bind(this))}},{key:"exeUboot",value:function(){return this.exe(m)}},{key:"_request",value:function(t,e,r){var n=new ArrayBuffer(16),i=new DataView(n);return i.setInt32(0,t,u),i.setInt32(4,e,u),i.setInt32(8,r,u),this._usbWrite(n)}},{key:"_status",value:function(){return this._usbRead(y)}},{key:"_usbWrite",value:function(t){return this._usbRequest(p,t.byteLength).then(this._writeToUsb.bind(this,t)).then(this._usbResponse.bind(this))}},{key:"_usbRead",value:function(t){var e=this;return this._usbRequest(h,t).then(this._readFromUsb.bind(this,t)).then(function(t){return e._usbResponse()["return"](t)})}},{key:"_usbRequest",value:function(t,e){var r=new ArrayBuffer(32),n=new DataView(r),i=201326592;return s.copyStringIntoArrayBuffer(g,r,0),n.setInt32(8,e,u),n.setInt32(12,i,u),n.setInt16(16,t,u),n.setInt32(18,e,u),this._writeToUsb(r)}},{key:"_usbResponse",value:function(){return this._readFromUsb(v).then(function(t){var e=new Uint8Array(t);if(0!==e[v-1])throw new Error("USB Response returned "+e[v-1]);if(!s.arrayBufferEquals(_,t,!0))throw new Error("Response was not AWUS");return!0})}},{key:"_writeToUsb",value:function(t){function e(r,n){var i=Math.min(t.byteLength-n,d);if(0>=i)return o.resolve(t);var a=new Uint8Array(t.slice(n,n+i));if(r.diagnosticMode){var u=r.dataProcessor.peekQueueFor("ExpectWrite");if(!s.arrayBufferEquals(u,a))throw new Error("mistmatch in _writeToUsb")}return r.dataTransferHandler.writePromise(a).then(e.bind(null,r,n+i))}return e(this,0).then(function(t){return t})}},{key:"_readFromUsb",value:function(t){function e(n,i){var a=Math.min(t-i,d);if(0>=a)return o.resolve(r);var u=new ArrayBuffer(a);return n.dataTransferHandler.readPromise(u,0,!0).then(function(t){if(n.diagnosticMode){var o=n.dataProcessor.peekQueueFor("ExpectRead");if(!s.arrayBufferEquals(o,t))throw new Error("mismatch in reading _readFromUsb")}return r.set(t,i),e(n,i+a)})}var r=new Uint8Array(t);return e(this,0).then(function(t){return t})}}]),t}();e.exports=T},{"./log":22,"./mkimage":23,"./uboot":30,"./util":31,bluebird:2}],11:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=t("bluebird"),s=t("./flasher"),a=t("./progress"),u=t("./settings"),c=t("./log"),l=t("./chromeFactory"),f=t("./sounds"),h=function(){function t(e,r){n(this,t),this.ports=new Set,this.document=null,this.flashInProgress=!1,this.done=!1,this.flashSrc=void 0,this.progress=new a,f.initialize(this.progress),this.factory=new l,this.flasher=new s(this.factory,this.progress),e&&this.addPort(e),this.addObservers(),this.pollForDeviceChanges()}return i(t,[{key:"pollForDeviceChanges",value:function(){var t=this;setInterval(function(){t.flashInProgress||t.done||t.flasher.readingEnvironment||t.flasher.getDeviceCount()},1e3)}},{key:"addObservers",value:function(){var t=this,e=this;this.progress.addDeviceObserver(function(e){t.postMessage({devices:e})}),this.progress.addProgressObserver(function(e){t.postMessage({progress:e})}),this.progress.addDataObserver(function(e){t.postMessage({data:e})}),this.progress.addStateObserver(function(t){(t.state===a.FAIL_STATE||t.state===a.PASS_STATE)&&(c.info("setting flashInProgress to false"),e.flashInProgress=!1,e.done=!0),e.postMessage({stateUpdate:t})})}},{key:"addPort",value:function(t){c.info("add port called"),this.ports.add(t),this.addPortListeners(t),this.flasher.getDeviceCount()}},{key:"removePort",value:function(t){this.ports["delete"](t)}},{key:"postMessage",value:function(t,e){if(e)this.ports.has(e)&&e.postMessage(t);else{var r=!0,n=!1,i=void 0;try{for(var o,s=this.ports[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var a=o.value;a.postMessage(t)}}catch(u){n=!0,i=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(n)throw i}}}}},{key:"createWindow",value:function(t){var e=this,r=this;return new o(function(n){chrome.app.window.create("popup.html",{innerBounds:{width:640,height:585},resizable:!1,hidden:e.headless},function(e){r.appWindow=e,r.appWindow.onClosed.addListener(function(){r.document=null,r.appWindow=null,r.flashInProgress&&r.flasher.cancel(),r.flashInProgress=!1,r.done=!1});var i=r.appWindow.contentWindow;r.data=i,r.data.flashSrc=r.flashSrc,r.data.flashTitle=r.flashTitle,r.data.maxChips=u.MAX_CHIPS,r.data.headless=r.headless,r.data.nfsBoot=r.nfsBoot,r.data.downloading=t,i.onload=function(){return r.document=i.document,n(r.appWindow)}})})}},{key:"addPortListeners",value:function(t){var e=this,r=this;t.onMessage.addListener(function(n,i){n.nand&&(e.nand=n.nand,e.flasher.forceNand(n.nand)),n.ping?e.postMessage({connect:!0},t):n.exitFlasher?e.done=!1:n.deviceCount?e.flasher.getDeviceCount():n.getEnvironment?e.flasher.getEnvironment():n.download?(e.logLevel=n.logLevel,c.setLevel(e.logLevel),e.headless=!!n.headless,e.flashTitle="Downloading...",e.showOrCreateWindow(!0).then(function(t){return t.downloading=!0,t}).then(e.flasher.readEnvironment.bind(e.flasher)).then(function(e){t.postMessage({download:n.download,env:e})})):!e.flashInProgress&&(n.nfsBoot||n.flashSrc||n.localFile)&&(e.logLevel=n.logLevel,c.setLevel(e.logLevel),e.stub=n.stub,e.flashSrc=null,e.headless=!!n.headless,e.nfsBoot=n.nfsBoot,n.flashSrc&&(e.flashSrc=n.flashSrc,e.flashTitle=n.flashTitle),e.done=!1,e.showOrCreateWindow(!1).then(function(t){return e.flasher.notifyEnvironment(),t})),n.startFlashing&&(c.info("chrome app start flashing",n),e.progress.init(),e.flashInProgress=!0,e.progress.notifyProgress(),o.resolve().then(function(){var t={stub:n.stub};return e.nfsBoot?t.nfsBoot=r.data.nfsBootContext:e.flashSrc?t.url=e.flashSrc:t.file=r.data.localFile,c.info("chrome app args",t),e.flasher.flash(t)})["catch"](function(t){c.info("error on flash "+t)}))}),t.onDisconnect.addListener(function(e){r.removePort(t)})}},{key:"showOrCreateWindow",value:function(t){var e=this;return this.appWindow?o.resolve().then(function(){return e.appWindow.contentWindow.downloading=t,e.appWindow.show(),e.appWindow.contentWindow.downloading=t,e.appWindow}):this.createWindow(t)}}]),t}();e.exports=h},{"./chromeFactory":12,"./flasher":21,"./log":22,"./progress":24,"./settings":26,"./sounds":27,bluebird:2}],12:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=t("./factory"),u=t("./readableStreamHandler"),c=t("./chromeUsb"),l=t("./fileHandler"),f=function(t){function e(){return n(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),s(e,[{key:"createStreamHandler",value:function(t,e,r,n){return r?new l(t,e):new u(t,e)}},{key:"createDeviceHandler",value:function(){return new c}},{key:"chooseFile",value:function(t,e){var r={type:"openFile"};return t&&(r.suggestedName=t),e&&(r.accepts=[{extensions:[e]}]),new Promise(function(t,e){chrome.fileSystem.chooseEntry(r,function(r){return chrome.runtime.lastError?e(new Error(chrome.runtime.lastError.message)):void t(r)})}).then(function(t){if(!t)throw new Error("No file");return new Promise(function(e,r){t.file(function(r){e([r,t.fullPath])})})})}},{key:"openFileByName",value:function(t,e){var r={};return e&&(r.volumeId=e),new Promise(function(t,e){chrome.fileSystem.requestFileSystem(r,function(r){return chrome.runtime.lastError?e(new Error(chrome.runtime.lastError.message)):void t(r)})}).then(function(e){return new Promise(function(r,n){e.root.getFile(t,{},function(t){r(t)})})}).then(function(t){if(!t)throw new Error("No file");return new Promise(function(e,r){t.file(function(t){e(t)})})})}}]),e}(a);e.exports=f},{"./chromeUsb":13,"./factory":19,"./fileHandler":20,"./readableStreamHandler":25}],13:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=t("bluebird"),u=t("./log"),c=t("./deviceHandlerInterface"),l=function(t){function e(){n(this,e);var t=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.timeout=3e5,t.configurationValue=1,t}return o(e,t),s(e,[{key:"getDevicesPromise",value:function(t,e){var r={};r.vendorId=t,r.productId=e;var n={filters:[r]};return new a(function(t,e){chrome.usb.getDevices(n,function(r){return chrome.runtime.lastError?e(new Error(chrome.runtime.lastError.message)):void t(r)})})}},{key:"openChipPromise",value:function(t){var e=this;return new a(function(e,r){chrome.usb.openDevice(t.device,function(n){return chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):(t.handle=n,void e(n))})}).then(function(r){return new a(function(n,i){chrome.usb.getConfigurations(t.device,function(t){if(chrome.runtime.lastError)return i(new Error(chrome.runtime.lastError.message));var o=e.configurationValue;return t&&t.length>0?(u.info("Configuration count"+t.length),o=t[0].configurationValue,u.info("USB Config value="+o),void n([r,o])):(u.error("No USB config found."),i(new Error(e.NO_CONFIG)))})})}).then(function(e){var r=e[0],n=e[1];return new a(function(e,i){chrome.usb.setConfiguration(r,n,function(){return chrome.runtime.lastError?(u.info("Could not set configuration to "+n),u.info(t),i(new Error(chrome.runtime.lastError.message))):(u.info("Set usb device configuration to "+n),void e(r))})})}).then(function(t){return new a(function(e,r){chrome.usb.listInterfaces(t,function(n){return chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):void e([t,n])})})}).then(function(r){var n=r[0],i=r[1],o=null,s=!0,u=!1,c=void 0;try{for(var l,f=i[Symbol.iterator]();!(s=(l=f.next()).done);s=!0){var h=l.value,p=h.endpoints,d=!0,v=!1,y=void 0;try{for(var _,g=p[Symbol.iterator]();!(d=(_=g.next()).done);d=!0){var m=_.value;"bulk"===m.type&&("in"===m.direction?(t.inEp=m,o=h):"out"===m.direction&&(t.outEp=m,o=h))}}catch(b){v=!0,y=b}finally{try{!d&&g["return"]&&g["return"]()}finally{if(v)throw y}}if(o){if(null===t.inEp||null===t.outEp)throw new Error(e.COULD_NOT_CLAIM_INTERFACES);break}}}catch(b){u=!0,c=b}finally{try{!s&&f["return"]&&f["return"]()}finally{if(u)throw c}}return new a(function(e,r){chrome.usb.claimInterface(n,o.interfaceNumber,function(){return chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):(t.goodChip=!0,void e(t))})})})["catch"](function(r){if(u.info("caught usb config error"+r),t.handle)return e.closePromise(t).then(function(){return null});throw r})}},{key:"writePromise",value:function(t,e){var r={};return r.direction="out",r.endpoint=t.outEp.address,r.data=e.buffer,r.length=e.byteLength,r.timeout=this.timeout,new a(function(n,i){chrome.usb.bulkTransfer(t.handle,r,function(t){return chrome.runtime.lastError?(u.error("Error writing"),u.error(chrome.runtime.lastError),i(new Error(chrome.runtime.lastError.message))):void n(0===t.resultCode?e.byteLength:0)})})}},{key:"readPromise",value:function(t,e){var r={};return r.direction="in",r.endpoint=t.inEp.address,r.length=e.byteLength,r.timeout=this.timeout,new a(function(e,n){chrome.usb.bulkTransfer(t.handle,r,function(t){return chrome.runtime.lastError?(u.error("Error reading"),u.error(chrome.runtime.lastError),n(new Error(chrome.runtime.lastError.message))):void e(0===t.resultCode?new Uint8Array(t.data):null)})})}},{key:"closePromise",value:function(t){return new a(function(e,r){chrome.usb.closeDevice(t.handle,function(){return t.init(),chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):void e(!0)})})}},{key:"resetPromise",value:function(t){return new a(function(e,r){chrome.usb.resetDevice(t.handle,function(){return t.init(),chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):void e(!0)})})}}]),e}(c);e.exports=l},{"./deviceHandlerInterface":17,"./log":22,bluebird:2}],14:[function(t,e,r){"use strict";function n(t){return i("UBI",t)}function i(t,e){return f.info("Erasing "+t+" in fastboot"),e.write("erase:"+t).then(function(){return e.read(p,!1)}).then(function(e){if(!e)throw new Error("erase:"+t+" not OKAY");return e})}function o(t,e){var r=this;return l.mapSeries(t,function(t){return r.getFastbootVar(t,e)}).then(function(e){for(var r={},n=0;n<t.length;n++)r[n]=e[n];return r})}function s(t,e){return f.info("getvar "+t),e.write("getvar:"+t).then(function(){var t=e.readBytes(v);return t&&t.startsWith(p)?t.substring(p.length):null})}function a(t){return o(["nand_oobsize","nand_erasesize","nand_writesize"])}function u(t){return h.arrayBufferEquals(d,t,!0)}function c(t){var e=h.bufferToString(t).split("\n"),r={},n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var u=s.value,c=u.indexOf("=");if(-1===c)break;r[u.substring(0,c)]=u.substring(c+1)}}catch(l){i=!0,o=l}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return r}var l=t("bluebird"),f=t("./log"),h=t("./util"),p="OKAY",d=h.stringToArr("continue"),v=64;e.exports={eraseUBI:n,erasePartition:i,getFastbootVar:s,isContinue:u,getFastbootVariables:o,getFastbootVar:s,getFastbootNandVariables:a,parseEnvironment:c}},{"./log":22,"./util":31,bluebird:2}],15:[function(t,e,r){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function z(t,e,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:z(i,e,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},a=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),u=t("bluebird"),c=t("./log"),l=t("./Queue"),f=t("./dataTransferHandler"),h=t("./progress"),p=t("./util"),d=t("./settings"),v=t("./errors"),y=t("./commands"),_=2,g=0,m=1,b=2,w=3,E=4,k=5,C=6,T=7,P=8,A=258,S=523956200,F=523898896,O=3978755898,j=function(){function t(e,r){o(this,t),this.dataProcessor=e,this.dataLength=r,this.id=++e.expectCount}return a(t,[{key:"clean",value:function(){this.dataProcessor=null,this.buffer=null}},{key:"parseAndGetNext",value:function(t){return this.buffer=t,new R(this.dataProcessor)}},{key:"process",value:function(){return!0}},{key:"isPlayedBack",value:function(){return!0}},{key:"isUncompressedWrite",value:function(){return!1}},{key:"isReadOrWrite",value:function(){return!1}},{key:"kind",value:function(){return"Expect"}}]),t}(),x=function(t){function e(t,r){o(this,e);var i=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,0));return i.fn=r,i}return i(e,t),a(e,[{key:"process",value:function(){var t=this;return u.resolve().then(function(){return t.fn()})}},{key:"kind",value:function(){return"ExpectMeta"}}]),e}(j),R=function(t){function e(t,r){o(this,e);var i=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,12));return i.first=r,i}return i(e,t),a(e,[{key:"parseMagicNumberAndEndian",value:function(t){c.debug("Parsing magic and endian");for(var e=0,r=[!0,!1],n=0;n<r.length;n++){var i=r[n],o=new DataView(t.buffer,0,4);if(e=o.getUint32(0,i),c.debug(e.toString(16)),e===S){c.debug("Reading FEL Data");break}if(e===F){c.debug("Reading FASTBOOT Data");break}if(0===e)c.debug("Ignoring 0 magic");else{if(e===O)throw c.debug("The file is a sparse file. It must be processed with howitzer"),new Error("Bad file format. This is a raw sparse file");if(!i)throw c.debug("Uh oh The file is not valid"),new Error("Bad file format")}}return[e,i]}},{key:"parseAndGetNext",value:function(t){var e=new DataView(t.buffer,4,3),r=e.getUint8(0);this.command=r;var n=null;if(this.first||r===g){var i=this.parseMagicNumberAndEndian(t);n=i[0],this.dataProcessor.endian=i[1]}var o=this.dataProcessor.endian,s=new DataView(t.buffer,0,4),a=s.getUint32(0,o),u=e.getUint8(1),l=parseInt(e.getUint8(2));s=new DataView(t.buffer,8,4);var f=s.getUint32(0,o);return l>_&&(c.error(this),c.error(l+" "+u+" "+a+" "+f+" "+e.getUint8(2)),c.error("Recorder version="+l+" Player version="+_),this.dataProcessor.badVer=!0),r===g?new I(this.dataProcessor,n,f,l):r===k?new D(this.dataProcessor,f):r===m?new B(this.dataProcessor,f):r===E?new W(this.dataProcessor,a):r===b?new N(this.dataProcessor,u,f):r===w?new L(this.dataProcessor,u,f):r===C?new H(this.dataProcessor,u,f,a):r===T?new M(this.dataProcessor,f,a):r===P?new V(this.dataProcessor,f,a):(c.info("Ignoring unknown command: "+r),new j(this.dataProcessor,f))}},{key:"isPlayedBack",value:function(){return!1}},{key:"kind",value:function(){return this.id+" ExpectHeader"}}]),e}(j),I=function(t){function e(t,r,i,s){o(this,e);var a=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,0));return a.magicNumber=r,a.recorderVersion=s,a.fileLength=i,a}return i(e,t),a(e,[{key:"parseAndGetNext",value:function(t){return this.magicNumber!==this.dataProcessor.magicNumber&&((1===this.recorderVersion||0===this.dataProcessor.totalBytes)&&this.dataProcessor.addTotalBytes(this.fileLength),this.dataProcessor.magicNumber=this.magicNumber,c.debug("MAGIC - read: "+this.magicName()+" file length: "+this.fileLength)),new R(this.dataProcessor)}},{key:"vidPid",value:function(){return p.magicToVidPid(this.magicNumber)}},{key:"magicName",value:function(){return this.magicNumber===S?"FEL":this.magicNumber===F?"FASTBOOT":"UNKNOWN"}},{key:"waitTimeout",value:function(){return this.magicNumber===S?1e4:this.magicNumber===F?35e3:void 0}},{key:"magicLabel",value:function(t,e){return t===S?e?h.WAITING_FOR_FEL:h.FEL:t===F?e?h.WAITING_FOR_FASTBOOT:h.FASTBOOT:void 0}},{key:"process",value:function(){var t=this,e=this.vidPid(),r=this.dataProcessor;r.progress.notifyStage(this.magicLabel(this.magicNumber,!0));var n=r.dataTransferHandler,i=r.currentProcessingMagic&&this.magicNumber!==r.currentProcessingMagic,o=n.waitForStatePromise(e[0],e[1],r.flashingCount,this.waitTimeout(),i).then(function(e){return c.info("---Process magic "+t.magicName()),e?(r.currentProcessingMagic=t.magicNumber,r.progress.notifyStage(t.magicLabel(t.magicNumber,!1)),!0):!1});return r.skipUntilMagic===this.magicNumber&&(r.skipUntilMagic=null,o.then(function(){return y.eraseUBI(n)})),r.firstMagic=r.firstMagic||this.magicNumber,r.lastMagic=this.magicNumber,o}},{key:"kind",value:function(){return this.id+" MAGIC"}}]),e}(j),U=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,0,0))}return i(e,t),a(e,[{key:"process",value:function(){var t=this,e=this.vidPid();return this.dataProcessor.deviceHandler.getDevicesPromise(e[0],e[1]).then(function(e){c.info("Magic check"),e.length>0&&(t.dataProcessor.skipUntilMagic=t.magicNumber)})}},{key:"parseAndGetNext",value:function(t){return null}},{key:"kind",value:function(){return this.id+" MAGIC CHECK"}}]),e}(I),B=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))}return i(e,t),a(e,[{key:"process",value:function(){return u.resolve(this.buffer).then(function(t){return c.info("Comment: "+p.arrToString(t)),!0})}},{key:"kind",value:function(){return this.id+" ExpectComment"}}]),e}(j),D=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))}return i(e,t),a(e,[{key:"parseAndGetNext",value:function(t){var r=p.arrToString(t,!0);return c.info(r),this.contents=JSON.parse(r),this.dataProcessor.manifest=this.contents,s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"parseAndGetNext",this).call(this,t)}},{key:"process",value:function(){var t=this;return u.resolve(this.buffer).then(function(e){return c.info("Manifest: "+t.contents),!0})}},{key:"kind",value:function(){return this.id+" ExpectManifest"}}]),e}(j),N=function(t){function e(t,r,i){o(this,e);var s=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.compressed=r,s.allowFailure=!1,s.dataProcessor.continueReached&&(s.allowFailure=!0),s}return i(e,t),a(e,[{key:"process",value:function(){return this.dataProcessor.dataTransferHandler.readPromise(this.buffer,this.id,this.allowFailure)}},{key:"kind",value:function(){return this.id+" ExpectRead "+this.dataLength}},{key:"isReadOrWrite",value:function(){return!0}}]),e}(j),L=function(t){function e(t,r,i){o(this,e);var s=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return s.compressed=r,s}return i(e,t),a(e,[{key:"parseAndGetNext",value:function(t){return y.isContinue(t)&&(c.info("Continue reached"),this.dataProcessor.continueReached=!0),s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"parseAndGetNext",this).call(this,t)}},{key:"process",value:function(){return this.dataProcessor.dataTransferHandler.writePromise(this.buffer,this.id)}},{key:"isUncompressedWrite",value:function(){return!this.compressed}},{key:"isReadOrWrite",value:function(){return!0}}]),e}(j),H=function(t){function e(t,r,i,s){o(this,e);var a=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return a.compressed=r,a.address=s,a}return i(e,t),a(e,[{key:"process",value:function(){return this.dataProcessor.felInstance.write(this.buffer,this.address)}},{key:"isReadOrWrite",value:function(){return!0}},{key:"kind",value:function(){return this.id+" ExpectFelWrite "+this.dataLength}}]),e}(j),M=function(t){function e(t,r,i){o(this,e);var s=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));return s.address=i,s}return i(e,t),a(e,[{key:"process",value:function(){return this.dataProcessor.felInstance.read(this.address,this.dataLength)}},{key:"isReadOrWrite",value:function(){return!0}},{key:"kind",value:function(){return this.id+" ExpectFelRead "+this.address+" "+this.dataLength;
}}]),e}(j),V=function(t){function e(t,r,i){o(this,e);var s=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));return s.address=i,s}return i(e,t),a(e,[{key:"process",value:function(){return this.dataProcessor.felInstance.exe(this.address)}},{key:"isReadOrWrite",value:function(){return!0}},{key:"kind",value:function(){return this.id+" ExpectFelExe "+this.address}}]),e}(j),W=function(t){function e(t,r){o(this,e);var i=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,0));return i.microseconds=r,i}return i(e,t),a(e,[{key:"process",value:function(){return u.delay(this.microseconds/1e3)}},{key:"kind",value:function(){return this.id+" Usleep"}}]),e}(j),q=function(){function t(e,r){o(this,t),this.deviceHandler=e,this.dataTransferHandler=new f(e),this.progress=r,this.spark=new SparkMD5.ArrayBuffer,this.initialize(),this.state=null}return a(t,[{key:"initialize",value:function(){this.expectCount=0,this.dataTransferHandler.initialize(),this.littleEndian=!1,this.readBuffer=null,this.expect=new R(this,!0),this.totalBytes=0,this.bytesWritten=0,this.enqueuedItems=0,this.queue=new l,this.head=null,this.reject=null,this.magicNumber=0,this.skipUntilMagic=null,this.spark.reset(),this.continueReached=!1,this.setState(h.PASSIVE_STATE),this.firstMagic=null,this.lastMagic=null,this.setInitialDeviceCount(),this.checkForFastboot(),this.queueDiagnosticSpot=0,this.currentProcessingMagic=0,this.felStateCount=0,this.environment=null,this.needToCheckFileCompatibility=!1,this.felInstance=null,this.manifest=null}},{key:"resetByteCounts",value:function(){this.totalBytes=0,this.bytesWritten=0,this.enqueuedItems=0,this.state=h.PASSIVE_STATE,this.magicNumber=0,this.spark=new SparkMD5.ArrayBuffer,this.currentProcessingMagic=0,this.manifest=null}},{key:"storeDataIfNeeded",value:function(t){if(this.currentProcessingMagic===S&&t.isReadOrWrite()){if(1===this.felStateCount){var e=new DataView(t.buffer.buffer),r=e.getUint16(0,p.LITTLE_ENDIAN);if(r===A){var n=1073741824,i=e.getUint32(4,p.LITTLE_ENDIAN);i>=n&&(this.dataTransferHandler.forceWaitForState=!0),this.felStateCount+=3}}this.felStateCount=(this.felStateCount+1)%9}}},{key:"setEnvironment",value:function(t){c.info("Setting environment",t),this.needToCheckFileCompatibility=!0,this.environment=t}},{key:"setFelInstance",value:function(t){this.felInstance=t}},{key:"calcHash",value:function(){if(this.spark){var t=this.spark.end(),e={serialNumbers:this.dataTransferHandler.serialNumbers,md5Hash:t};return this.progress.notifyData(e),t}return null}},{key:"setInitialDeviceCount",value:function(){var t=this;this.addMeta(function(){return t.dataTransferHandler.getDeviceCount2(S,F).then(function(e){return t.initialDeviceCount=e,e>d.MAX_CHIPS&&(e=d.MAX_CHIPS,t.notifyState(new Error("C.H.I.P.s detected = "+e+", but can only flash "+d.MAX_CHIPS))),t.flashingCount=e,e})})}},{key:"checkForFastboot",value:function(){var t=new U(this,F);this.addToQueue(t)}},{key:"startedWithFastboot",value:function(){return this.firstMagic===F}},{key:"setState",value:function(t){t!==this.state&&(this.state=t,this.notifyState(t))}},{key:"addTotalBytes",value:function(t){this.totalBytes+=t,this.progress.setTotalBytes(this.totalBytes)}},{key:"setStreamHandler",value:function(t){this.streamHandler=t}},{key:"addToQueue",value:function(t){var e=!1;e||(this.enqueuedItems++,this.queue.enqueue(t),1===this.queue.getLength()&&(c.debug("processing head"),this.processHead())),t.dataLength>0&&this.streamHandler.addBytes(t.dataLength)}},{key:"removeFromQueue",value:function(t){return this.state!==h.FAIL_STATE?(this.enqueuedItems--,this.storeDataIfNeeded(t),t.clean(),this.queue.dequeue(),c.info("removed "+t.kind()+" len "+t.dataLength+" from queue. Now at  "+this.streamHandler.enqueuedBytes+"bytes, items="+this.enqueuedItems),this.processHead(),this.progress.addBytes(t.dataLength,this.enqueuedItems),this.streamHandler.addBytes(-t.dataLength),!0):void 0}},{key:"addMeta",value:function(t){this.addToQueue(new x(this,t))}},{key:"addCleanUpMeta",value:function(t){var e=this;this.addMeta(function(){return e.cleanUpPromise().then(function(){return c.meta("Flashing finished! Elapsed time: "+((new Date).getTime()-t)/1e3),!0})})}},{key:"processHead",value:function(){var t=this;if(!p.enqueueOnly){if(this.dataTransferHandler.errorState)return c.error("aborting in processHead"),this.handleError(this.dataTransferHandler.errorState);if(this.head=this.queue.peek(),this.head){if(this.skipUntilMagic&&this.head.magicNumber!==this.skipUntilMagic)return void this.removeFromQueue(this.head);this.head.process()["catch"](Error,function(e){return c.error("caught error in process head and calling handlError"+e),t.handleError(e)}).then(function(){return t.state!==h.FAIL_STATE?t.removeFromQueue(t.head):void 0})}}}},{key:"isDone",value:function(){return this.state===h.FAIL_STATE||this.state===h.PASS_STATE}},{key:"handleError",value:function(t){var e=this;if(this.state===h.FAIL_STATE)return!1;c.error("Handling error"),c.error(t),this.state=h.FAIL_STATE;var r={error:t,text:t.toString()};return r.report=t instanceof v.ReportableError,this.head&&(r.index=this.head.id,r.operation=this.head.kind()),c.error(r),this.queue=new l,this.notifyState(r),this.cleanUpPromise().then(function(){return c.error("cleaned up after error"),e.reject?(t instanceof Error||(t=new Error(t)),e.reject(t)):t})}},{key:"notifyState",value:function(t){var e={state:this.state};t&&(e.error=t),e.startedWithFastboot=this.startedWithFastboot(),e.booting=this.continueReached,e.initialDeviceCount=this.initialDeviceCount,e.flashingCount=this.flashingCount,e.serialNumbers=this.dataTransferHandler.serialNumbers,this.progress.notifyState(e)}},{key:"cleanUpPromise",value:function(){var t=this;return this.dataTransferHandler.closeAllExcept(0,0)["catch"](function(t){return c.error("Error on cleanup"),c.error(t),null}).then(function(){return c.info("Closed all devices"),t.state!==h.FAIL_STATE&&(t.state=h.PASS_STATE,t.notifyState()),t.progress.notifyStage(h.DONE),!0})}},{key:"processChunk",value:function(t){if(this.spark&&this.spark.append(t),this.state===h.FAIL_STATE)return!1;this.setState(h.ACTIVE_STATE),this.readBuffer?this.readBuffer=p.appendBuffer(this.readBuffer,t):this.readBuffer=t;try{for(;this.readBuffer.byteLength>=this.expect.dataLength;){var e=this.expect,r=null;e.dataLength>0&&(r=this.readBuffer.slice(0,e.dataLength),this.readBuffer=this.readBuffer.slice(e.dataLength)),this.expect=e.parseAndGetNext(r),this.checkCompatibility(e),e.isPlayedBack()&&this.addToQueue(e)}}catch(n){return this.handleError(n)}return!0}},{key:"checkCompatibility",value:function(t){if(this.needToCheckFileCompatibility&&t.isReadOrWrite()){this.needToCheckFileCompatibility=!1;var e=this.environment;if(this.manifest){if(!this.manifest.initrd&&this.manifest.nandChip&&this.manifest.nandChip.id!==e.nandChip.id){var r=new v.CompatibilityError(this.manifest.nandChip.id,e.nandChip.id);this.handleError(r)}}else if(e.nandChip!==e.defaultNandChip){var n=new v.CompatibilityError(e.defaultNandChip.id,e.nandChip.id);this.handleError(n)}else c.info("No manifest, but file is compatible with this chip")}}},{key:"peekQueueFor",value:function(t){for(;;){var e=this.queue.elementAt(this.queueDiagnosticSpot);if(!e)throw new Error("peekQueueFor past end: "+this.queueDiagnosticSpot);if(this.queueDiagnosticSpot++,e.kind().includes(t))return e.buffer;if(e instanceof N||e instanceof L)throw new Error("Expecting "+t+" but got "+e.kind())}}}]),t}();e.exports=q},{"./Queue":8,"./commands":14,"./dataTransferHandler":16,"./errors":18,"./log":22,"./progress":24,"./settings":26,"./util":31,bluebird:2}],16:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=t("bluebird"),s=t("./log"),a=t("./util"),u=0,c=1e3,l=function(){function t(e){n(this,t),this.init(),this.device=e,this.serialNumber=e.serialNumber}return i(t,[{key:"init",value:function(){this.handle=null,this.inEp=null,this.outEp=null,this.writeIndex=0,this.state=u}},{key:"magicNumber",value:function(){return(this.vid<<16)+this.pid}}]),t}(),f=function(){function t(e){n(this,t),this.deviceHandler=e,this.forceWaitForState=!1,this.initialize()}return i(t,[{key:"resetChips",value:function(){return 1===this.chips.length?this.deviceHandler.resetPromise(this.chips[0]):o.resolve()}},{key:"initialize",value:function(){s.info("DataTransferHandler initialize"),this.chips=[],this.errorState=null}},{key:"waitForStatePromise",value:function(t,e,r,n,i){var u=this;t=t||7994,e=e||61416,r=r||1,n=n||2e4;var c=this;return o.resolve().then(function(){if(u.forceWaitForState&&(u.initialize(),u.forceWaitForState=!1),c.chips&&c.chips.length>0){for(var i=0,o=0;r>o;o++)t===c.chips[o].vid&&e===c.chips[o].pid&&i++;if(i===r)return!0}var l=function(){return c.openAllPromise(t,e,r).then(function(n){return s.info("open all vid pid devices",t.toString(16),e.toString(16),n),n&&n.length===r})}.bind(c);return c.closeAllExcept(t,e).then(function(){return a.pollPromise(l,1e3,n)}).then(function(r){return s.debug("Just polled for device "+t.toString(16)+":"+e.toString(16)),r})})}},{key:"openAllPromise",value:function(t,e,r){var n=this,i=this;return this.chips=[],this.deviceHandler.getDevicesPromise(t,e).then(function(n){return n.length<r?null:(n=n.slice(0,r),o.delay(r*c).then(function(){return o.map(n,function(r){var n=new l(r);return i.chips.push(n),n.vid=t,n.pid=e,i.deviceHandler.openChipPromise(n)})}))}).then(function(t){if(n.chips=t,t){var e=!0,r=!1,o=void 0;try{for(var u,c=t[Symbol.iterator]();!(e=(u=c.next()).done);e=!0){var l=u.value;if(!l)return n.initialize(),null}}catch(f){r=!0,o=f}finally{try{!e&&c["return"]&&c["return"]()}finally{if(r)throw o}}i.serialNumbers=a.listSerialNumbers(t)}return s.info("opened "+(t?t.length:0)+" chips"),t})}},{key:"closeAllExcept",value:function(t,e){var r=this,n=[],i=[];if(this.chips){var a=!0,u=!1,c=void 0;try{for(var l,f=this.chips[Symbol.iterator]();!(a=(l=f.next()).done);a=!0){var h=l.value;h.vid!==t||h.pid!==e?n.push(this.deviceHandler.closePromise(h)):i.push(h)}}catch(p){u=!0,c=p}finally{try{!a&&f["return"]&&f["return"]()}finally{if(u)throw c}}}var d=o.all(n).then(function(){r.chips=i,s.info("just closed all CHIPs. new count is "+r.chips.length)});return d.dbg="closeAllExcept "+t.toString(16)+":"+e.toString(16),d}},{key:"writePromise",value:function(t,e){e=e||0;var r=this.deviceHandler.writePromise(this.chips[0],t);return r.dbg="writePromise "+e,r}},{key:"readPromise",value:function(t,e,r){var n=this;e=e||0;var i=this.deviceHandler.readPromise(this.chips[0],t);return i.then(function(i){if(a.arrayBufferEquals(i,t,!0))return i;if(r)return t;throw s.error("BAD READ index "+e+"failed to read back correctly"),s.error("read: "+a.arrToString(i)+" expecting "+a.arrToString(t)),n.errorState=new Error("bad read back "+e),n.errorState})["catch"](function(e){if(r||"Device disconnected."===e.message)return t;throw e}),i.dbg="readPromise "+e,i}},{key:"write",value:function(t){return this.writePromise(a.stringToArr(t))}},{key:"read",value:function(t,e){return t instanceof string&&(t=a.stringToArr(t)),this.readPromise(t).then(function(r){return e?a.arrayBufferEquals(t,r,!0):a.arrToString(r)})}},{key:"readBytes",value:function(t){return this.read(new Uint8Array(t),!1)}},{key:"getDeviceCount",value:function(t){var e=a.magicToVidPid(t);return this.deviceHandler.getDevicesPromise(e[0],e[1]).then(function(t){return t.length})}},{key:"getDeviceCount2",value:function(t,e){var r=this;return this.getDeviceCount(t).then(function(t){return t?t:r.getDeviceCount(e)})}}]),t}();e.exports=f},{"./log":22,"./util":31,bluebird:2}],17:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=function(){function t(){n(this,t)}return i(t,[{key:"getDevicesPromise",value:function(t,e){throw"not implemented"}},{key:"openChipPromise",value:function(t){throw"not implemented"}},{key:"writePromise",value:function(t,e){throw"not implemented"}},{key:"readPromise",value:function(t,e){throw"not implemented"}},{key:"closePromise",value:function(t){throw"not implemented"}},{key:"resetPromise",value:function(t){throw"not implemented"}}]),t}();e.exports=o},{}],18:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(t){function e(){return n(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),e}(Error),a=function(t){function e(t,r){n(this,e);var o=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"The .chp file you are using was built for CHIPS with "+t+" NAND, is not compatible with your NAND type: "+r+". If you wish to flash from a .chp file, you will need to download it again from flash.getchip.com"));return o.chpFileType=t,o.nandType=r,o}return o(e,t),e}(s);e.exports={ReportableError:s,CompatibilityError:a}},{}],19:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=function(){function t(){n(this,t)}return i(t,[{key:"createStreamHandler",value:function(t,e,r,n){}},{key:"createDeviceHandler",value:function(){}},{key:"chooseFile",value:function(t,e){}},{key:"openFileByName",value:function(t,e){}}]),t}();e.exports=o},{}],20:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=t("bluebird"),u=t("./streamHandler"),c=t("./log"),l=(t("./util"),function(t){function e(t,r){n(this,e);var o=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));return o.pausable=!1,o.offset=0,o.chunkSize=32768,o.file=null,o.fileReader=new FileReader,o.fileReader.onload=o.onLoad.bind(o),o.resolve=null,o.done=!1,o}return o(e,t),s(e,[{key:"onLoad",value:function(t){var e=this.dataProcessor;return e.isDone()?void(this.done=!0):(e.reject=this.reject,t.target.error?void e.handleError(t.target.error):(this.offset+=t.target.result.byteLength,e.processChunk(new Uint8Array(t.target.result)),this.offset>=this.fileSize?(e.spark&&c.meta("Hash code is"+e.calcHash()),e.addCleanUpMeta(this.startTime),void e.addMeta(this.resolve)):void(this.pausable&&this.paused||this.read())))}},{key:"read",value:function(){if(!this.done){var t=this.file.slice(this.offset,this.chunkSize+this.offset);return this.fileReader.readAsArrayBuffer(t)}}},{key:"doFetch",value:function(t){var e=this;return new a(function(r,n){return e.resolve=r,e.reject=n,e.file=t,e.fileSize=t.size,e.read()})}}]),e}(u));e.exports=l},{"./log":22,"./streamHandler":28,"./util":31,bluebird:2}],21:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=t("bluebird"),s=t("./dataProcessor"),a=t("./stubUsb"),u=(t("./dataTransferHandler"),t("./commands"),t("./progress")),c=t("./uboot"),l=(t("./fileHandler"),t("./streamHandler")),f=t("./basicFel"),h=t("./log"),p=t("./util"),d="binary/u-boot-dtb.bin.lzma",v="binary/spl_no_ecc.chp.lzma",y=function(){function t(e,r,i){n(this,t),this.factory=e,this.progress=r,this.deviceHandler=this.factory.createDeviceHandler(),this.isWindows=-1!==navigator.appVersion.indexOf("Win"),this.felInstance=null,this.env=null,this.readingEnvironment=!1,this.lastCount=0,this.nand=null}return i(t,[{key:"forceNand",value:function(t){h.info("forcing Nand",t),this.nand=t}},{key:"onDeviceAddRemove",value:function(t){this.getDeviceCount()}},{key:"getDeviceCount",value:function(t,e){var r=this;return this.readingEnvironment?o.resolve():(t=t||7994,e=e||61416,this.deviceHandler?void this.deviceHandler.getDevicesPromise(t,e).then(function(e){return e&&e.length>0?o.resolve(e):r.deviceHandler.getDevicesPromise(t,4112)}).then(function(t){var e=t.length,n=p.listSerialNumbers(t),i=r.lastCount<e,s=r.lastCount>e;return r.progress.notifyDeviceCount(e,n,r.lastCount),r.lastCount=e,i&&!r.readingEnvironment?r.readEnvironment().then(function(t){return t?(r.env=t,r.dataProcessor.setEnvironment(t),r.dataProcessor.resetByteCounts(),e):e})["catch"](function(t){return r.env=null,e}):(s&&(r.dataProcessor.initialize(),r.env=null),o.resolve(e))}):0)}},{key:"prepareFlash",value:function(t){if(!this.dataProcessor){var e=this.deviceHandler;"1"==t&&(e=new a),this.dataProcessor=new s(e,this.progress)}}},{key:"enqueuedBytes",value:function(){return p.enqueueOnly?null:5e6}},{key:"_flashFileOrUrl",value:function(t,e,r,n){var i=this;this.prepareFlash(n);var s=e(this.dataProcessor,this.enqueuedBytes(),r);return o.resolve().then(function(){return i.env?i.env:i.readEnvironment()}).then(function(e){return i.dataProcessor.setEnvironment(e),i.dataProcessor.resetByteCounts(),s.doFetch(t)})}},{key:"flash",value:function(t){return t.url?this._flashFileOrUrl(t.url,this.factory.createStreamHandler,!1,t.stub):t.file?this._flashFileOrUrl(t.file,this.factory.createStreamHandler,!0,t.stub):t.nfsBoot?this.nfsBoot(t.nfsBoot):void 0}},{key:"readEnvironment",value:function(){var t=this;if(this.readingEnvironment)return o.resolve(null);if(this.nand){var e=c.makeFakeEnvironment(this.nand);return this.progress.notifyData({environment:e}),o.resolve(e)}return this.readingEnvironment=!0,h.info("reading environment"),this.progress.notifyStage(u.READING_DEVICE_INFO,u.ACTIVE_STATE),this.progress.pause(),this.readUbootVars().then(function(e){return t.progress.init(),t.progress.notifyProgress(),t.progress.notifyData({environment:e}),e})["catch"](function(e){h.error("caught err in uboot env read"+e),t.env=null})["finally"](function(){t.readingEnvironment=!1,t.progress.resume(),t.progress.notifyStage(u.WAITING,u.PASSIVE_STATE),h.info("DONE reading environment")})}},{key:"getEnvironment",value:function(){var t=this;return o.resolve().then(function(){return t.env?t.env:t.readEnvironment()}).then(function(e){t.notifyEnvironment()})}},{key:"notifyEnvironment",value:function(){return this.env?(this.progress.notifyData({environment:this.env}),!0):!1}},{key:"flashFromCompressedUrl",value:function(t,e){var r=this;return h.info("flashFromCompressedUrl"),new o(function(n,i){r.prepareFlash(e);var o=r.dataProcessor;return o.reject=i,o.streamHandler=new l(o),p.fetchUrlIntoArrayBuffer(t,!0).then(o.processChunk.bind(o)).then(o.addMeta.bind(o,n))})["catch"](function(t){throw h.error("caught error",t),t})}},{key:"spl",value:function(){return h.info("spl"),this.flashFromCompressedUrl(v)}},{key:"writeUboot",value:function(t,e){var r=this.fel();return t=t||d,e=e||t.endsWith(".lzma"),p.fetchUrlIntoArrayBuffer(t,e).then(r.writeUboot.bind(r))}},{key:"fel",value:function(t){return this.felInstance||(this.prepareFlash(t),this.felInstance=new f(this.dataProcessor.dataTransferHandler),this.dataProcessor.setFelInstance(this.felInstance)),this.felInstance}},{key:"readUbootVars",value:function(){h.info("readUbootVars");var t=this.fel();return this.spl().then(this.writeUboot.bind(this,d,!0)).then(t.writeUbootScript.bind(t,c.exportEnvironmentString)).then(t.exeUboot.bind(t)).then(t.waitForFel.bind(t,this.isWindows)).then(t.read.bind(t,c.felEnvScratch,c.felEnvScratchLength)).then(c.parseEnvironment)}},{key:"nfsBoot",value:function(t){var e=this.fel(),r=c.toNfsEnvironment(t.root);return this.spl().then(this.writeUboot.bind(this,d,!0)).then(p.readFile.bind(p,t.kernel)).then(e.writeZImage.bind(e)).then(p.readFile.bind(p,t.dtb)).then(e.writeDtb.bind(e)).then(e.writeUbootScript.bind(e,r)).then(e.exeUboot.bind(e))["catch"](function(t){h.error(t)})}},{key:"cancel",value:function(){this.dataProcessor.handleError("User Cancel"),console.log("ChromeFlash.cancel(): User has cancelled flash!")}}]),t}();e.exports=y},{"./basicFel":10,"./commands":14,"./dataProcessor":15,"./dataTransferHandler":16,"./fileHandler":20,"./log":22,"./progress":24,"./streamHandler":28,"./stubUsb":29,"./uboot":30,"./util":31,bluebird:2}],22:[function(t,e,r){"use strict";var n={debug:function(t){i&&console.log(t)},error:function(t){o&&console.log(t)},info:function(t){s&&console.log(t)},trace:function(t){u&&console.log(t)},meta:function(t){a&&console.log(t)},setLevel:function(t){if(t){var e=t.toUpperCase();"DEBUG"===e?(console.log("Setting log level to "+e),i=!0,o=!0,s=!0,a=!0):"INFO"===e&&(console.log("Setting log level to "+e),i=!1,o=!0,s=!0,a=!0)}}},i=!1,o=!0,s=!1,a=!0,u=!1;e.exports=n},{}],23:[function(t,e,r){"use strict";function n(t,e,r){if(e=e||"generated",r=r||u,t instanceof ArrayBuffer){if(new DataView(t).getUint32(0,!1)===a)return t;t=new Uint8Array(t)}t instanceof Uint8Array&&(t=s.toString(t)),"\n"!==t.slice(-1)&&(t+="\n");var n=s.stringToArr(e).slice(0,p),i=t.length,d=new ArrayBuffer(h+i),v=new Uint8Array(d),y=new DataView(d);y.setUint32(0,a,c),y.setUint32(8,(new Date).getTime(),c),y.setUint32(8,305419896,c),y.setUint32(12,i+f,c),y.setUint32(28,r,c),v.set(n,32),y.setUint32(l,i,c),v.set(s.stringToArr(t),h);var _=o.buf(Array.from(new Uint8Array(d.slice(l))));y.setUint32(24,_,c);var g=o.buf(Array.from(new Uint8Array(d.slice(0,l))));return y.setUint32(4,g,c),d}function i(t){s.bufferToString(t.slice(l))}var o=t("crc-32"),s=t("./util"),a=654645590,u=84018688,c=!1,l=64,f=8,h=l+f,p=32;e.exports={toImage:n,fromImage:i}},{"./util":31,"crc-32":4}],24:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=function(){function t(){n(this,t),this.init(),this.cleanUp()}return i(t,[{key:"init",value:function(){this.currentPercent=0,this.totalBytes=0,this.bytes=0,this.start=null,this.lastKnownStage=null,this.paused=!1}},{key:"cleanUp",value:function(){this.progressObservers=[],this.deviceObservers=[],this.stateObservers=[],this.dataObservers=[]}},{key:"pause",value:function(){this.paused=!0}},{key:"resume",value:function(){this.paused=!1}},{key:"addProgressObserver",value:function(t){this.progressObservers.push(t)}},{key:"addDeviceObserver",value:function(t){this.deviceObservers.push(t)}},{key:"addStateObserver",value:function(t){this.stateObservers.push(t)}},{key:"addDataObserver",value:function(t){this.dataObservers.push(t)}},{key:"setTotalBytes",value:function(t){this.totalBytes=t}},{key:"addBytes",value:function(t,e){if(!this.paused){var r=!this.start;this.start||(this.start=(new Date).getTime()),this.bytes+=t;var n=Math.floor(100*this.bytes/this.totalBytes);100===n&&0!==e&&(n=99),(r||n!==this.currentPercent)&&(this.currentPercent=n,this.notifyProgress())}}},{key:"notifyProgress",value:function(){if(!this.paused){var t=(new Date).getTime()-this.start,e=this.bytes||1,r=t*this.totalBytes/e-t,n={bytes:this.bytes,totalBytes:this.totalBytes,percent:this.currentPercent,estimatedTimeRemaining:r},i=!0,o=!1,s=void 0;try{for(var a,u=this.progressObservers[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var c=a.value;c(n)}}catch(l){o=!0,s=l}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw s}}}}},{key:"notifyDeviceCount",value:function(e,r,n){if(!this.paused){var i=e>n,o=n>e,s={count:e,serialNumberArray:r,added:i,removed:o};1===e&&(s.serialNumber=r[0]);var a=!0,u=!1,c=void 0;try{for(var l,f=this.deviceObservers[Symbol.iterator]();!(a=(l=f.next()).done);a=!0){var h=l.value;h(s)}}catch(p){u=!0,c=p}finally{try{!a&&f["return"]&&f["return"]()}finally{if(u)throw c}}0!==e&&0===n&&this.notifyState({state:t.PASSIVE_STATE,stage:t.WAITING})}}},{key:"notifyStage",value:function(t,e){var r={stage:t};e&&(r.state=e),this.lastKnownStage=t,this.notifyState(r)}},{key:"notifyState",value:function(t){if(!this.paused){var e=!0,r=!1,n=void 0;try{for(var i,o=this.stateObservers[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;s(t)}}catch(a){r=!0,n=a}finally{try{!e&&o["return"]&&o["return"]()}finally{if(r)throw n}}}}},{key:"notifyData",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=this.dataObservers[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;s(t)}}catch(a){r=!0,n=a}finally{try{!e&&o["return"]&&o["return"]()}finally{if(r)throw n}}}}]),t}();o.DISCONNECTED_STATE=-1,o.PASSIVE_STATE=0,o.ACTIVE_STATE=1,o.PAUSED_STATE=2,o.PROMPT_STATE=3,o.PASS_STATE=4,o.FAIL_STATE=5,o.IDLE_STATE=6,o.DONE="Done",o.WAITING="Waiting",o.WAITING_FOR_FEL="Waiting for FEL",o.FEL="Processing FEL",o.WAITING_FOR_FASTBOOT="Waiting for Fastboot",o.FASTBOOT="Processing Fastboot",o.READING_DEVICE_INFO="Reading device information",o.INITIALIZING="Initializing",o.NEED_TO_UPDATE_APP="You need to update the App. Go to chrome://extensions and click 'Update extensions now'",e.exports=o},{}],25:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=t("bluebird"),u=t("./streamHandler"),c=t("./log"),l=(t("./util"),function(t){function e(t,r){n(this,e);var o=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));return o.pausable=!1,o}return o(e,t),s(e,[{key:"doFetch",value:function(t){var e=this,r={mode:"cors",redirect:"follow"};return c.info("Doing fetch "+t),fetch(t,r).then(function(t){return e.readableStream=t.body.getReader(),e.read()})["catch"](function(t){return c.error(t),e.dataProcessor.handleError(t),null})}},{key:"readWithRetries",value:function(){return this.readableStream.read()}},{key:"read",value:function(){var t=this;c.debug("read()");var e=this;return new a(function(r,n){return t.dataProcessor.reject=n,t.readWithRetries().then(function i(t){return t&&t.done?(c.debug("done"),e.dataProcessor.spark&&c.meta("Hash code is "+e.dataProcessor.calcHash()),e.dataProcessor.addCleanUpMeta(e.startTime),e.dataProcessor.addMeta(r),!0):t&&e.dataProcessor.processChunk(t.value)?e.pausable&&e.paused?null:e.readWithRetries().then(i):(c.error("Aborting on error"),e.readableStream.cancel&&e.readableStream.cancel(),e.dataProcessor.cleanUpPromise().then(function(){c.meta("FAILURE!======== Elapsed time: "+((new Date).getTime()-e.startTime)/1e3),n(new Error("Some error"))}))}.bind(t))})["catch"](function(t){c.error(t)})}}]),e}(u));e.exports=l},{"./log":22,"./streamHandler":28,"./util":31,bluebird:2}],26:[function(t,e,r){"use strict";var n=1;e.exports={MAX_CHIPS:n}},{}],27:[function(t,e,r){"use strict";function n(t){s&&(t.addDeviceObserver(function(t){var e=null;t.added?e="audio/derp.mp3":t.removed&&(e="audio/disconnect.mp3"),e&&new Audio(e).play()}),t.addStateObserver(function(t){var e=null;t.state===i?e="audio/tada.mp3":t.state===o&&(e="audio/doh.mp3"),e&&new Audio(e).play()}))}var i=(t("./errors"),t("./progress"),4),o=5,s=!1;e.exports={initialize:n}},{"./errors":18,"./progress":24}],28:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=t("./log"),s=function(){function t(e,r){n(this,t),this.dataProcessor=e,this.dataProcessor.setStreamHandler(this),this.enqueuedByteLimit=r||Number.MAX_VALUE,this.paused=!1,this.enqueuedBytes=0,this.startTime=(new Date).getTime()}return i(t,[{key:"doFetch",value:function(t){throw"virtual, must implement"}},{key:"addBytes",value:function(t){this.enqueuedBytes+=t,t>0&&this.enqueuedBytes>=this.enqueuedByteLimit&&this.highWaterMark(!0),0>t&&this.enqueuedBytes<this.enqueuedByteLimit&&this.highWaterMark(!1)}},{key:"highWaterMark",value:function(t){this.defaultHighWaterMark(t)}},{key:"defaultHighWaterMark",value:function(t){this.pausable&&(o.debug("Highwater="+t),t?this.paused||(this.paused=!0,o.debug("Pausing read----------------------")):this.paused&&(this.paused=!1,o.debug("Resuming read-------------------------"),this.read()))}}]),t}();e.exports=s},{"./log":22}],29:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=t("bluebird"),u=(t("./log"),t("./util")),c=t("./deviceHandlerInterface"),l=function(t){function e(){n(this,e);var t=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return console.log("using stub usb"),t}return o(e,t),s(e,[{key:"getDevicesPromise",value:function(t,e){return a.resolve([1])}},{key:"openChipPromise",value:function(t){return a.resolve([1])}},{key:"writePromise",
value:function(t,e){return a.resolve(e.length).then(function(){return e.length<50&&console.log("Write: "+u.arrToString(e)),e.length})}},{key:"closePromise",value:function(t){return a.resolve(!0)}},{key:"readPromise",value:function(t,e){return a.resolve(e).then(function(){return console.log("Read: "+u.arrToString(e)),e})}}]),e}(c);e.exports=l},{"./deviceHandlerInterface":17,"./log":22,"./util":31,bluebird:2}],30:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=t("./util"),s=4096,a=31744,u=512,c="echo Reading Environment Information\nsetenv customName CHIP_Pro\nsetenv bootdelay 1\nnand info\nenv export -t -s "+u.toString(16)+" "+a.toString(16)+" nand_erasesize nand_writesize nand_oobsize serial# ethaddr usbnet_devaddr customName\nsaveenv\nreset",l="echo NFS Booting\nsetenv bootargs earlyprintk g_cdc.host_addr={0} root=/dev/nfs rw nfsroot=192.168.1.1:{1} ip=192.168.1.2 ${kernelarg_video}\nbootz 0x42000000 - 0x43000000",f="00:11:22:33:44:55",h={"default":!0,name:"H27QCG8T2E5R‐BCF 64G 3.3V 8-bit",displayName:"Hynix 8G MLC",id:"Hynix_8G_MLC",nand_erasesize:4194304,nand_oobsize:1664,nand_writesize:16384,capacity:8589934592},p={name:"toshiba 32G 8-bit",displayName:"Toshiba 4G MLC",id:"Toshiba_4G_MLC",nand_erasesize:4194304,nand_oobsize:1280,nand_writesize:16384,capacity:4294967296},d={name:"TC58NVG2SS0HT 4G 3.3V 8-bit",displayName:"Toshiba 512M MLC",id:"Toshiba_512M_MLC",nand_erasesize:262144,nand_oobsize:256,nand_writesize:4096,capacity:536870912},v=[h,p,d],y=function(){function t(){n(this,t)}return i(t,null,[{key:"findNand",value:function(t,e,r){var n=!0,i=!1,o=void 0;try{for(var s,a=v[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var u=s.value;if(u.nand_erasesize===t&&u.nand_oobsize===e&&u.nand_writesize===r)return u}}catch(c){i=!0,o=c}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}throw console.log("nand_erasesize, nand_oobsize, nand_writesize",t.toString(16),e.toString(16),r.toString(16)),new Error("NAND not found ")}},{key:"findNandById",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=v[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;if(s.id===t)return s}}catch(a){r=!0,n=a}finally{try{!e&&o["return"]&&o["return"]()}finally{if(r)throw n}}throw new Error("NAND not found ")}},{key:"makeFakeEnvironment",value:function(e){var r={};return r.nandChip=t.findNandById(e),r.defaultNandChip=h,r["serial#"]="not read",r}},{key:"parseEnvironment",value:function(e){var r=o.bufferToString(e).split("\n"),n={},i=!0,s=!1,a=void 0;try{for(var u,c=r[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var l=u.value,f=l.indexOf("=");if(-1===f)break;var p=l.substring(0,f),d=l.substring(f+1);(p.startsWith("nand_")||d.startsWith("0x"))&&(d=parseInt(d,16)),n[p]=d}}catch(v){s=!0,a=v}finally{try{!i&&c["return"]&&c["return"]()}finally{if(s)throw a}}return n.nandChip=t.findNand(n.nand_erasesize,n.nand_oobsize,n.nand_writesize),n.defaultNandChip=h,n}},{key:"toNfsEnvironment",value:function(t,e){return e=e||f,l.format(e,t)}}]),t}();y.exportEnvironmentString=c,y.felScratch=s,y.felEnvScratch=a,y.felEnvScratchLength=u,e.exports=y},{"./util":31}],31:[function(t,e,r){"use strict";function n(t,e){var r=String.fromCharCode.apply(null,t);return e&&(r=r.replace(/\n/g," ")),r}function i(t){return n(new Uint8Array(t))}function o(t,e){e=e||999999;for(var r="",n=0;n<t.byteLength;n++){var i=t[n];if(r+=32>i||i>127?".":String.fromCharCode(i),n>=e){r+="---LONG";break}}return r}function s(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}function a(t,e,r){return n(new Uint8Array(t.slice(e,r)))}function u(t,e,r){r=r||0;for(var n=new Uint8Array(e),i=0;i<t.length;i++)n[i+r]=t.charCodeAt(i)}function c(t,e,r){var n=t.byteLength;if(r){if(e.byteLength<n)return!1}else if(t.byteLength!==e.byteLength)return!1;for(var i=0;n>i;i++)if(t[i]!==e[i])return!1;return!0}function l(t,e){var r=new Uint8Array(t.byteLength+e.byteLength);return r.set(t,0),r.set(e,t.byteLength),r}function f(t,e,r){function n(){return i?b.resolve(!1):t()["catch"](function(t){return w.info("Error when polling. likely benign"+t),!1}).then(function(t){return t?b.resolve(t):b.delay(e).then(n)})}var i=!1;return n().timeout(r)["catch"](b.TimeoutError,function(t){throw i=!0,t})}function h(t){return[t>>16,65535&t]}function p(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var a=o.value;a.serialNumber&&e.push(a.serialNumber)}}catch(u){n=!0,i=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(n)throw i}}return e}function d(t,e){var r=Number(t).toString(16);for(e="undefined"==typeof e||null===e?e=8:e;r.length<e;)r="0"+r;return r}function v(t,e){e=e||256;for(var r=new Uint8Array(t),n="",i=0,o=0;o<t.byteLength;o++){var s=r[o];n+=d(s,2)+" ",(o+1)%e===0&&(console.log(d(i,3)+": "+n),n="",i++)}console.log(d(i,3)+": "+n)}function y(t){var e=new DataView(t.buffer);return e.getUint32(0,k)}function _(t,e){var r=this;return e=e||!1,fetch(t,{mode:"cors"}).then(function(t){return t.arrayBuffer()}).then(function(t){return e?r.unLzma(t):t})}function g(t){var e=new FileReader;return new b(function(r){e.onloadend=function(t){return r(t.target.result)},e.readAsArrayBuffer(t)})}function m(t){return new b(function(e){var r=Array.from(new Uint8Array(t)),n=LZMA.decompress(r),i=Uint8Array.from(n);e(i)})}var b=t("bluebird"),w=t("./log");String.prototype.format||(String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(e,r){return"undefined"!=typeof t[r]?t[r]:e})});var E=3,k=!0,C=!1;e.exports={arrToString:n,bufferToString:i,copyStringIntoArrayBuffer:u,arrayBufferEquals:c,appendBuffer:l,pollPromise:f,stringToArr:s,arrToStringConvertNonAscii:o,magicToVidPid:h,listSerialNumbers:p,subArrayToString:a,toHex:d,letoh32:y,enqueueOnly:C,fetchUrlIntoArrayBuffer:_,readFile:g,unLzma:m,MAX_CHIPS:E,dumpBuffer:v,LITTLE_ENDIAN:k}},{"./log":22,bluebird:2}]},{},[9]);